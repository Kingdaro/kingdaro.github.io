webpackJsonp([1],{180:function(e,t){},56:function(e,t,n){"use strict";function r(e){const{size:t=16,name:n,style:r}=e,a=U.c(e,["size","name","style"]),s=`public/icons/${n}.svg`,i=Object.assign({width:t+"px",height:t+"px",display:"inline-block",lineHeight:0,cursor:"inherit",verticalAlign:"middle"},r);return D.createElement("img",Object.assign({src:s,style:i},a))}function a(e){return D.createElement("div",{className:"Loading-shade fullscreen flex-column flex-center"},D.createElement("div",null,D.createElement(r,{name:"paw",size:100,className:"Loading-icon"})),D.createElement("h2",{className:"Loading-text"},e.text))}function s(e){return t=>{t.preventDefault(),e&&e(t)}}function i(e){const{text:t,active:n,children:r}=e,a=U.c(e,["text","active","children"]);return D.createElement("a",Object.assign({href:"#",className:`margin-left margin-right block ${e.active?"":"faded"}`},a),e.text)}function o(e,t={}){const n=e+"?"+ae.stringify(t);return fetch(n,{method:"POST"}).then(e=>e.json())}function c(e,t){return U.a(this,void 0,void 0,function*(){const n=yield o("https://www.f-list.net/json/getApiTicket.php",{account:e,password:t});if(n.error)throw new Error(n.error);return n.ticket})}function l(e,t){return U.a(this,void 0,void 0,function*(){const n=yield o("https://www.f-list.net/json/api/character-list.php",{account:e,ticket:t});if(n.error)throw new Error(n.error);return n.characters})}function h(e){return encodeURI(e.toLowerCase())}function d(e){return`https://static.f-list.net/images/avatar/${h(e)}.png`}function p(e){return`https://www.f-list.net/c/${h(e)}`}function u(e){return`https://static.f-list.net/images/eicon/${h(e)}.gif`}function m(e){return se.parse(e)}function b(e){return`<a class='bbc-icon' href='${p(e)}' target='_blank' style='${`background-image: url(${d(e)})`}'></a>`}function v(e){return`<div class='bbc-icon' style='background-image: url(${u(e)})'></div>`}function g(e){return`<a href='#' class='bbc-channel' data-channel='${e}'>`+`<i class='mdi mdi-earth'></i> ${e}`+`</a>`}function C(e,t){return`<a href='#' class='bbc-channel' data-channel='${e}'>`+`<i class='mdi mdi-key-variant'></i> ${t}`+`</a>`}function f(e,t){const{pathname:n}=Object(re.parse)(e),r=n?ne.a.extname(n):"";return`<a class='bbc-link' href='${e}' target='_blank'>`+`<i class='mdi mdi-${[".png",".jpg",".jpeg",".svg",".gif"].includes(r)?"image":"link-variant"}'></i> ${t}`+`</a>`}function y(e){const t=e.visible?"overlay-visible":"overlay-hidden",n="overlay-panel overlay-panel-"+e.side;return D.createElement(oe,{className:`fullscreen overlay-shade ${t}`,onClick:s(t=>{const n=t.target;n instanceof HTMLDivElement&&n.classList.contains("overlay-shade")&&e.onShadeClicked&&e.onShadeClicked()})},D.createElement(ce,{className:`${n} bg-color-main flex-row`},e.children))}function E(e){switch(e){case"normal":return"";case"lfrp":return"highlight-green";case"admin":return"highlight-red";case"system":return""}}function S(e){const t=s(t=>{const n=t.target;n instanceof HTMLDivElement&&n.classList.contains("Overlay-shade")&&e.onShadeClick&&e.onShadeClick()});return D.createElement("div",{className:"Overlay-shade",onClick:t},D.createElement("div",{className:"Overlay-panel"},e.children))}function w(e){return D.createElement(Ue,{href:"#",className:"padding block no-line-height",onClick:s(e.onClick)},D.createElement(r,{name:e.icon,size:32}))}function x(e){const{title:t,type:n}=e,a="public"===n?"earth":"key";return D.createElement("div",{className:"flex-row flex-align-center"},D.createElement(r,{name:a,className:"margin-right"})," ",D.createElement("span",null,t))}function k(e){const t=e.active?"bg-color-main":"";return D.createElement(Ae,{className:`${t} flex-row flex-align-stretch`,active:e.active},D.createElement("a",{href:"#",className:"flex-grow padding",onClick:s(e.onActivate)},e.children),D.createElement($e,{href:"#",className:"flex-center padding no-line-height"},D.createElement(r,{name:"close",onClick:s(e.onClose)})))}function N(e){return D.createElement("div",{className:"flex-row flex-align-center"},D.createElement("img",{src:d(e.partner),className:"margin-right",style:{width:"24px",height:"24px",verticalAlign:"middle"}}),e.partner)}function M(e){return e.map(e=>new qe("public",e.name,e.title||e.name,e.characters))}function j(){return D.createElement("div",null,D.createElement(P.Provider,Object.assign({},gt),D.createElement(Xe,null)),Ct&&D.createElement(I.a,{position:{right:0,bottom:0}}))}function O(){T.render(D.createElement(j,null),document.getElementById("root"))}Object.defineProperty(t,"__esModule",{value:!0});n(57);var P=n(3),L=n(69),I=n.n(L),D=n(0),T=n(13),U=n(1),A=n(2);n(70);class ${constructor(e=!1){this.visible=e}show(){this.visible=!0}hide(){this.visible=!1}toggle(){this.visible=!this.visible}get isOpen(){return this.visible}}U.b([A.observable],$.prototype,"visible",void 0),U.b([A.action.bound],$.prototype,"show",null),U.b([A.action.bound],$.prototype,"hide",null),U.b([A.action.bound],$.prototype,"toggle",null),U.b([A.computed],$.prototype,"isOpen",null);var H=n(38),B=n.n(H);class J{constructor(e){this.storageKey=e}save(e){return U.a(this,void 0,void 0,function*(){return H.setItem(this.storageKey,e)})}restore(){return U.a(this,void 0,void 0,function*(){return H.getItem(this.storageKey)})}}var _;!function(e){e[e.setup=0]="setup",e[e.login=1]="login",e[e.characterSelect=2]="characterSelect",e[e.connecting=3]="connecting",e[e.online=4]="online"}(_=_||(_={}));class F{constructor(e){this.auth=e,this.state=_.setup,this.appInfo=new $,this.hasRun=new J("AppStore_hasRun")}setState(e){this.state=e}init(){return U.a(this,void 0,void 0,function*(){try{yield this.auth.loadAuthData(),yield this.auth.fetchCharacters(),this.setState(_.characterSelect)}catch(e){this.setState(_.login)}(yield this.hasRun.restore())||(yield this.hasRun.save(!0),this.appInfo.show())})}}U.b([A.observable],F.prototype,"state",void 0),U.b([A.action],F.prototype,"setState",null),U.b([A.action.bound],F.prototype,"init",null);var R=n(4),V=n(26),K=n(14),z=n.n(K);const G=Object(R.a)("a")("> *{vertical-align:text-bottom;}");let W=class extends D.Component{constructor(){super(...arguments),this.store=this.props.channelBrowserStore,this.currentList="publicChannels",this.searchText="",this.handleSearchInput=(e=>{this.setSearchText(e.currentTarget.value)}),this.renderChanelListEntry=(e=>{const t=this.props.channelStore.isJoined(e.id)?"bg-color-main":"faded";return D.createElement("a",{key:e.id,href:"#",className:`flex-row ${t}`,onClick:()=>this.toggleChannel(e.id)},D.createElement("div",{className:"padding flex-grow",dangerouslySetInnerHTML:{__html:e.title}}),D.createElement("div",{className:"padding"},e.userCount))})}setCurrentList(e){this.currentList=e}setSearchText(e){this.searchText=e}toggleChannel(e){const t=this.props.chatStore;this.props.channelStore.isJoined(e)?t.leaveChannel(e):t.joinChannel(e)}get publicChannels(){return this.sortChannels(this.filterChannels(this.store.publicChannels))}get privateChannels(){return this.sortChannels(this.filterChannels(this.store.privateChannels))}sortChannels(e){return z()(e,e=>e.title.toLowerCase())}filterChannels(e){const t=this.searchText.trim().toLowerCase();return t.length>0?e.filter(e=>e.title.toLowerCase().includes(t)):e}render(){return D.createElement("div",{className:"flex-column fill-area bg-color-darken-1"},D.createElement("div",{className:"flex-row"},this.renderTab("Public","earth","publicChannels"),this.renderTab("Private","key","privateChannels")),D.createElement("div",{className:"flex-grow scroll-v"},this.renderChannels(this.publicChannels,"publicChannels"),this.renderChannels(this.privateChannels,"privateChannels")),D.createElement("div",{className:"flex-row padding bg-color-main"},D.createElement("input",{className:"flex-grow margin-right",type:"text",placeholder:"Search...",onInput:this.handleSearchInput}),D.createElement("button",{onClick:s(this.props.onDone)},"Done")))}renderTab(e,t,n){const a=`flex-grow flex-row flex-align-center padding ${this.currentList===n?"bg-color-main":"faded"}`;return D.createElement(G,{href:"#",className:a,onClick:()=>this.setCurrentList(n)},D.createElement(r,{name:t,size:24,className:"margin-right"})," ",e)}renderChannels(e,t){return D.createElement("div",{style:{display:this.currentList===t?void 0:"none"}},e.map(this.renderChanelListEntry))}};U.b([A.observable],W.prototype,"currentList",void 0),U.b([A.observable],W.prototype,"searchText",void 0),U.b([A.action],W.prototype,"setCurrentList",null),U.b([Object(V.debounce)(800)],W.prototype,"setSearchText",null),U.b([A.action],W.prototype,"toggleChannel",null),U.b([A.computed],W.prototype,"publicChannels",null),U.b([A.computed],W.prototype,"privateChannels",null),W=U.b([Object(P.inject)("chatStore","channelStore","channelBrowserStore"),P.observer],W);const X=Object(R.a)("div")("@media (max-width:750px){display:none;}"),Y=Object(R.a)("div")("@media (min-width:750px){display:none;}"),q=Object(R.a)("div")(">:not(:last-child){margin-right:8px;}");let Q=class extends D.Component{render(){return D.createElement(q,{className:"bg-color-darken-2 flex-row flex-align-center padding"},D.createElement(Y,{className:"no-line-height"},D.createElement("a",{href:"#",onClick:this.props.chatViewStore.navigator.toggle},D.createElement(r,{name:"menu",size:24}))),D.createElement("div",{className:"flex-grow"},this.props.children))}};Q=U.b([Object(P.inject)("chatViewStore"),P.observer],Q);let Z=class extends D.Component{constructor(){super(...arguments),this.message=""}handleInput(e){this.message=e.currentTarget.value}handleKeyDown(e){if("Enter"===e.key&&!e.ctrlKey&&!e.shiftKey){e.preventDefault();const t=this.message.trim();t.length>0&&this.props.onMessage&&this.props.onMessage(t),this.message=""}}render(){const e=this.props,{className:t,onMessage:n}=e,r=U.c(e,["className","onMessage"]);return D.createElement("div",Object.assign({className:`flex-row padding ${t}`},r),D.createElement("textarea",{className:"flex-grow padding margin-right",placeholder:"Say something...",style:{resize:"none"},value:this.message,onInput:this.handleInput,onKeyDown:this.handleKeyDown}),D.createElement("button",{style:{width:"80px"}},"Send"))}};U.b([A.observable],Z.prototype,"message",void 0),U.b([A.action.bound],Z.prototype,"handleInput",null),U.b([A.action.bound],Z.prototype,"handleKeyDown",null),Z=U.b([P.observer],Z);var ee=n(172),te=n(173),ne=n.n(te),re=n(175),ae=n(55);const se=Object(ee.createParser)({b:{render:e=>`<span class="bbc-bold">${e}</span>`},i:{render:e=>`<span class="bbc-italic">${e}</span>`},u:{render:e=>`<span class="bbc-underline">${e}</span>`},s:{render:e=>`<span class="bbc-strike">${e}</span>`},sup:{render:e=>`<span class="bbc-super">${e}</span>`},sub:{render:e=>`<span class="bbc-sub">${e}</span>`},url:{render:(e,t)=>f(t,e)},color:{render:(e,t)=>t?`<span class="bbc-color-${t}">${e}</span>`:e},noparse:{render:e=>e,deep:!1},icon:{render:e=>b(e)},eicon:{render:e=>v(e)},user:{render:e=>b(e)},session:{render:(e,t)=>C(e,t)},channel:{render:e=>g(e)}});class ie extends D.Component{constructor(){super(...arguments),this.shouldScroll=!1}componentWillUpdate(){const e=T.findDOMNode(this);e.scrollTop+e.clientHeight===e.scrollHeight&&(this.shouldScroll=!0)}componentDidUpdate(){if(this.shouldScroll){const e=T.findDOMNode(this);e.scrollTop=e.scrollHeight,this.shouldScroll=!1}}render(){return D.Children.only(this.props.children)}}const oe=Object(R.a)("div")("background-color:rgba(0,0,0,0.5);transition:0.3s;> .overlay-panel{transition:0.3s;}&.overlay-hidden{opacity:0;visibility:hidden;> .overlay-panel-left{transform:translateX(-100%);}> .overlay-panel-right{transform:translateX(100%);}}&.overlay-visible{opacity:1;visibility:visible;> .overlay-panel{transform:translateX(0%);}}"),ce=Object(R.a)("div")("position:absolute;top:0;bottom:0;box-shadow:0px 0px 8px black;&.overlay-panel-left{left:0;}&.overlay-panel-right{right:0;}"),le=Object(R.a)("span")("line-height:0;font-size:120%;vertical-align:middle;"),he=Object(P.inject)("characterStore")(Object(P.observer)(function(e){const{name:t}=e,{gender:n,status:r}=e.characterStore.getCharacter(t),a="character-gender-"+n.toLowerCase(),s="character-status-"+r.toLowerCase();return D.createElement("a",{href:p(t),target:"_blank",className:`${a} text-bold`,"data-character":t},D.createElement(le,{className:s,title:r},"â€¢")," ",t)})),de=/^\s*\/me\s*/,pe=Object(R.a)("div")("&:nth-child(2n){background-color:rgba(0,0,0,0.15);}"),ue=Object(P.inject)(function(e,t){const{sender:n}=t.message;return{isSenderIgnored:e.chatStore.isIgnored(n)}})(Object(P.observer)(function(e){if(e.isSenderIgnored)return null;const{sender:t,text:n,type:r,date:a}=e.message,s=n.trim().startsWith("/me"),i=m(n.replace(de,"")),o=s?"text-italic":"",c=E(r);return D.createElement(pe,{className:`${o}`},D.createElement("div",{className:`padding ${c}`},D.createElement("span",{className:"margin-left text-small text-italic faded float-right"},"[",a.toLocaleTimeString(),"]"),D.createElement("span",{className:"margin-right"},D.createElement(he,{name:t})),D.createElement("span",{className:`preserve-ws`,dangerouslySetInnerHTML:{__html:i}})))})),me=Object(R.a)("div")("padding:4px 8px;");let be=class extends D.Component{constructor(){super(...arguments),this.renderUser=(e=>D.createElement(me,{className:`${this.getHighlightClass(e)}`,key:e},D.createElement(he,{name:e})))}get unignoredUsers(){const e=this.props.chatStore;return this.props.users.filter(t=>!e.isIgnored(t))}get sortedUsers(){const{characterStore:e,chatStore:t}=this.props;return z()(this.unignoredUsers,n=>{const r=e.getCharacter(n),{friends:a,admins:s}=t;return s.has(n)?0:this.props.ops.includes(n)?1:a.has(n)?2:"looking"===r.status?3:4},e=>e.toLowerCase())}getHighlightClass(e){const{chatStore:t}=this.props,{friends:n,admins:r}=t;return r.has(e)?"highlight-red":this.props.ops.includes(e)?"highlight-yellow":n.has(e)?"highlight-blue":""}render(){return D.createElement("div",null,this.sortedUsers.map(this.renderUser))}};U.b([A.computed],be.prototype,"unignoredUsers",null),U.b([A.computed],be.prototype,"sortedUsers",null),be=U.b([Object(P.inject)("characterStore","chatStore"),P.observer],be);const ve=Object(R.a)("div")("display:grid;grid-gap:4px;// on mobile\n  @media (max-width:750px){grid-template-rows:auto 1fr 80px;grid-template-columns:1fr;grid-template-areas:'chat-header' 'message-list' 'chat-input';}// on desktop\n  @media (min-width:750px){grid-template-rows:auto 80px 1fr 80px;grid-template-columns:1fr 200px;grid-template-areas:'chat-header chat-header' 'description description'\n      'message-list user-list' 'chat-input chat-input';}"),ge=Object(R.a)("div")("grid-area:chat-header;"),Ce=Object(R.a)("div")("grid-area:message-list;"),fe=Object(R.a)(X)("grid-area:description;height:80px;"),ye=Object(R.a)(X)("grid-area:user-list;"),Ee=Object(R.a)("div")("grid-area:chat-input;");let Se=class extends D.Component{constructor(){super(...arguments),this.displayedMode="both",this.infoDrawer=new $,this.renderMessage=((e,t)=>D.createElement(ue,{key:t,message:e}))}setDisplayedMode(e){this.displayedMode=e}get parsedDescription(){return{__html:m(this.props.channel.description)}}get filteredMessages(){const{messages:e}=this.props.channel;return"both"!==this.props.channel.mode?e:"ads"===this.displayedMode?e.filter(e=>"lfrp"===e.type):"chat"===this.displayedMode?e.filter(e=>"normal"===e.type):e}renderModeFilter(e,t){return D.createElement(i,{key:e,onClick:s(()=>this.setDisplayedMode(e)),text:t,active:this.displayedMode===e})}renderHeader(){const{channel:e}=this.props;return D.createElement(ge,null,D.createElement(Q,null,D.createElement("div",{className:"flex-row flex-align-center"},D.createElement("h3",{className:"flex-grow"},e.title),D.createElement("div",{className:"flex-row"},"both"===e.mode&&[this.renderModeFilter("chat","Chat"),this.renderModeFilter("ads","Ads"),this.renderModeFilter("both","Both")]),D.createElement(Y,null,D.createElement("a",{href:"#",onClick:s(this.infoDrawer.show)},D.createElement(r,{name:"more-vert",size:24}))))))}renderDescription(){return D.createElement(fe,{className:"bg-color-main scroll-v padding preserve-ws",dangerouslySetInnerHTML:this.parsedDescription})}renderInfoDrawer(){const{channel:e}=this.props;return D.createElement(y,{side:"right",visible:this.infoDrawer.isOpen,onShadeClicked:this.infoDrawer.hide},D.createElement("div",{className:"scroll-v",style:{width:"240px"}},D.createElement("h3",{className:"padding"},"Description"),D.createElement("div",{className:"bg-color-darken-1 padding preserve-ws",dangerouslySetInnerHTML:this.parsedDescription}),D.createElement("h3",{className:"padding"},"Users (",e.getUserCount(),")"),D.createElement("div",{className:"bg-color-darken-1"},D.createElement(be,{users:e.getUsers(),ops:e.ops}))))}render(){const{channel:e,className:t=""}=this.props;return D.createElement(ve,{className:`${t} fill-area`},this.renderHeader(),this.renderDescription(),D.createElement(ie,null,D.createElement(Ce,{className:"bg-color-darken-1 flex-grow scroll-v"},this.filteredMessages.slice(0,300).map(this.renderMessage))),D.createElement(ye,{className:"bg-color-main scroll-v"},D.createElement(be,{users:e.users,ops:e.ops})),D.createElement(Ee,{className:"bg-color-main flex-row"},D.createElement(Z,{className:"flex-grow",onMessage:this.props.onMessage})),this.renderInfoDrawer())}};U.b([A.observable],Se.prototype,"displayedMode",void 0),U.b([A.action],Se.prototype,"setDisplayedMode",null),U.b([A.computed],Se.prototype,"parsedDescription",null),U.b([A.computed],Se.prototype,"filteredMessages",null);const we=Se=U.b([Object(P.inject)(function(e,t){const{channelStore:n,chatStore:r}=e;return{channel:n.getChannel(t.id),onMessage(e){r.sendChannelMessage(t.id,e)}}}),P.observer],Se),xe=Object(R.a)("img")("width:100px;height:100px;display:block;"),ke=Object(P.inject)(function(e,t){const n=e.characterStore.getCharacter(t.name);return{status:n.status,statusMessage:n.statusMessage}})(Object(P.observer)(function(e){const{name:t,status:n,statusMessage:r}=e;return D.createElement("div",{className:"padding"},D.createElement("a",{href:p(t),target:"_blank"},D.createElement("h2",{style:{margin:0}},t)),D.createElement("div",{className:"spacer"}),D.createElement("a",{href:p(t),target:"_blank"},D.createElement(xe,{src:d(t),alt:`Avatar for ${t}`,key:t})),D.createElement("div",{className:"spacer"}),D.createElement("div",{className:"bg-color-darken-1 padding text-italic text-small"},D.createElement("span",{className:`character-status-${n.toLowerCase()}`},n),""!==r.trim()&&D.createElement("span",{dangerouslySetInnerHTML:{__html:" - "+m(r)}})))})),Ne=Object(R.a)("div")("width:200px;position:fixed;box-shadow:0px 0px 8px black;"),Me=Object(R.a)("a")("opacity:0.5;&:hover{opacity:1;}");let je=class extends D.Component{updatePosition(){const e=T.findDOMNode(this),t=e.getBoundingClientRect(),{x:n,y:r}=this.props,a=n+t.width,s=r+t.height;e.style.left=n-Math.max(a-(window.innerWidth-16),0)+"px",e.style.top=r-Math.max(s-(window.innerHeight-16),0)+"px"}componentDidMount(){this.updatePosition()}componentDidUpdate(){this.updatePosition()}handleMessageAction(){this.props.chatStore.openPrivateChat(this.props.character)}renderIgnoreAction(){const{character:e}=this.props,t=this.props.chatStore,n=t.ignored.has(e),a=n?"remove-circle":"remove-circle-outline",s=n?"Unignore":"ignore",i=n?t.unignore:t.ignore;return D.createElement(Me,{className:"padding",href:"#",onClick:i.bind(t,e)},D.createElement(r,{name:a,key:"ignore-action"})," ",s)}render(){const{character:e}=this.props;return D.createElement(Ne,{className:"bg-color-darken-1 flex-column"},D.createElement("div",{className:"bg-color-main"},D.createElement(ke,{name:e})),D.createElement(Me,{className:"padding",href:"#",onClick:this.handleMessageAction},D.createElement(r,{name:"message"})," Send Message"),D.createElement(Me,{className:"padding",href:p(e),target:"_blank"},D.createElement(r,{name:"link"})," Open Profile"),this.renderIgnoreAction())}};U.b([A.action.bound],je.prototype,"handleMessageAction",null),je=U.b([Object(P.inject)("chatStore"),P.observer],je);const Oe=Object(R.a)("div")("opacity:",e=>e.visible?1:0,";visibility:",e=>e.visible?"visible":"hidden",";transition:0.3s;");n(180);let Pe=class extends D.Component{renderMessages(){const{messages:e}=this.props.privateChat;return e.map((e,t)=>D.createElement(ue,{key:t,message:e}))}render(){return D.createElement("div",{className:"flex-column fill-area"},D.createElement(Q,null,D.createElement("div",{className:"flex-row"},D.createElement("h3",{className:"flex-grow"},D.createElement(he,{name:this.props.partner})),D.createElement("img",{className:"block",src:d(this.props.partner),style:{width:"24px",height:"24px"}}))),D.createElement("div",{className:"divider-v"}),D.createElement(ie,null,D.createElement("div",{className:"flex-grow bg-color-darken-1"},this.renderMessages())),D.createElement("div",{className:"divider-v"}),D.createElement("div",{className:"bg-color-main"},D.createElement(Z,{onMessage:this.props.onMessage})))}};const Le=Pe=U.b([Object(P.inject)(function(e,t){const{privateChatStore:n,chatStore:r}=e;return{privateChat:n.getPrivateChat(t.partner),onMessage(e){r.sendPrivateMessage(t.partner,e)}}}),P.observer],Pe),Ie=Object(R.a)("div")("width:400px;height:600px;max-width:calc(100vw - 40px);max-height:calc(100vh - 40px);");let De=class extends D.Component{constructor(){super(...arguments),this.renderEntry=(e=>D.createElement("div",{key:e,className:"bg-color-darken-1 padding flex-row flex-align-center spaced-children-h"},D.createElement("img",{src:d(e),style:{width:"24px",height:"24px"}}),D.createElement(he,{name:e})))}render(){const{onlineFriends:e,offlineFriends:t,ignoredUsers:n}=this.props;return D.createElement(Ie,{className:"bg-color-main padding spaced-children-v scroll-v"},D.createElement("h2",null,"Friends / Bookmarks"),this.renderUserList(e),D.createElement("h2",null,"Offline"),this.renderUserList(t),D.createElement("h2",null,"Ignored"),this.renderUserList(n))}renderUserList(e){return e.length>0?e.map(this.renderEntry):D.createElement("div",{className:"padding text-small text-italic faded"},"No users found.")}};const Te=De=U.b([Object(P.inject)(function(e){const t=z()(e.chatStore.friends.keys());return{onlineFriends:t.filter(t=>"offline"!==e.characterStore.getCharacter(t).status),offlineFriends:t.filter(t=>"offline"===e.characterStore.getCharacter(t).status),ignoredUsers:Array.from(e.chatStore.ignored.keys())}}),P.observer],De),Ue=Object(R.a)("a")("opacity:0.5;&:hover{opacity:1;}"),Ae=Object(R.a)("div")("&:hover{opacity:",e=>e.active?1:.75,";}opacity:",e=>e.active?1:.5,";"),$e=Object(R.a)("a")("opacity:0.3;&:hover{opacity:0.7;}");let He=class extends D.Component{constructor(){super(...arguments),this.renderChannelTab=(e=>{const t=this.props.currentRoute,n="channel"===t.type&&t.id===e.id;return D.createElement(k,{active:n,key:e.id,onActivate:()=>{this.props.onChannelActivate(e.id)},onClose:()=>{this.props.onChannelClose(e.id)}},D.createElement(x,{title:e.title,type:"public"}))}),this.renderPrivateChatTab=(e=>{const t=this.props.currentRoute,n="private-chat"===t.type&&t.partner===e.partner;return D.createElement(k,{key:e.partner,active:n,onActivate:()=>{this.props.onPrivateChatActivate(e.partner)},onClose:()=>{this.props.onPrivateChatClose(e.partner)}},D.createElement(N,{partner:e.partner}))})}render(){const{joinedChannels:e,privateChats:t}=this.props,n=z()(e,e=>e.title.toLowerCase());return D.createElement("div",{className:"bg-color-darken-1 flex-grow flex-column scroll-v"},D.createElement("h3",{className:"margin faded"},"Channels"),n.map(this.renderChannelTab),D.createElement("h3",{className:"margin faded"},"Private Chats"),t.map(this.renderPrivateChatTab))}};const Be=He=U.b([Object(P.inject)(function(e){const{chatStore:t,chatViewStore:n,channelStore:r,privateChatStore:a}=e,s=a.getOpenPrivateChats().filter(e=>!t.isIgnored(e.partner));return{currentRoute:n.route,joinedChannels:z()(r.getJoinedChannels(),e=>e.title.toLowerCase()),privateChats:z()(s,e=>e.partner.toLowerCase()),onChannelActivate(e){n.setRoute({type:"channel",id:e}),n.navigator.hide()},onChannelClose(e){t.leaveChannel(e)},onPrivateChatActivate(e){n.setRoute({type:"private-chat",partner:e}),n.navigator.hide()},onPrivateChatClose(e){t.removePrivateChat(e)}}}),P.observer],He);let Je=class extends D.Component{render(){return D.createElement("div",{className:"bg-color-main flex-row full-height",style:{width:"240px"}},D.createElement("div",{className:"bg-color-darken-2 flex-column"},D.createElement("section",{className:"flex-grow flex-column"},D.createElement(w,{icon:"forum",onClick:this.props.onChannelBrowser}),D.createElement(w,{icon:"account-circle",onClick:this.props.onStatusMenu}),D.createElement(w,{icon:"account-multiple",onClick:this.props.onFriendBrowser}),D.createElement(w,{icon:"info",onClick:this.props.onInfo})),D.createElement("section",{className:"flex-column"},D.createElement(w,{icon:"exit",onClick:this.props.onExit}))),D.createElement("div",{className:"flex-grow flex-column flex-align-stretch"},D.createElement(ke,{name:this.props.identity}),D.createElement("div",{className:"bg-color-darken-2 divider-v"}),D.createElement(Be,null)))}};const _e=Je=U.b([Object(P.inject)(function(e){const{chatStore:t,chatViewStore:n,appStore:r}=e;return{identity:t.identity,onStatusMenu:n.statusMenu.show,onFriendBrowser:n.friendBrowser.show,onChannelBrowser(){n.channelBrowser.show(),t.fetchChannelList()},onExit(){t.disconnectFromServer()},onInfo(){r.appInfo.toggle()}}}),P.observer],Je);let Fe=class extends D.Component{constructor(){super(...arguments),this.fields={status:"",statusMessage:""},this.updateStatus=this.linkField("status"),this.updateStatusMessage=this.linkField("statusMessage")}linkField(e){return t=>{this.fields[e]=t.currentTarget.value}}handleSubmit(e){this.props.chatStore.updateStatus(this.fields.status,this.fields.statusMessage),this.props.chatViewStore.statusMenu.hide()}componentDidMount(){const e=this.props.chatStore.identityCharacter;this.fields.status=e.status,this.fields.statusMessage=e.statusMessage}render(){return D.createElement("div",{className:"bg-color-main"},D.createElement("form",{onSubmit:s()},D.createElement("fieldset",null,D.createElement("h2",{style:{margin:0}},this.props.chatStore.identity)),D.createElement("fieldset",null,D.createElement("select",{value:this.fields.status,onInput:this.updateStatus},D.createElement("option",{value:"online"},"Online"),D.createElement("option",{value:"looking"},"Looking"),D.createElement("option",{value:"away"},"Away"),D.createElement("option",{value:"busy"},"Busy"),D.createElement("option",{value:"dnd"},"DND"))),D.createElement("fieldset",null,D.createElement("textarea",{placeholder:"Status message...",value:this.fields.statusMessage,onInput:this.updateStatusMessage})),D.createElement("fieldset",null,D.createElement("button",{type:"submit",onClick:s(this.handleSubmit)},"Update"))))}};U.b([A.observable],Fe.prototype,"fields",void 0),U.b([A.action],Fe.prototype,"updateStatus",void 0),U.b([A.action],Fe.prototype,"updateStatusMessage",void 0),U.b([A.action.bound],Fe.prototype,"handleSubmit",null),Fe=U.b([Object(P.inject)("chatStore","chatViewStore"),P.observer],Fe);const Re=Object(R.a)("div")("width:400px;height:600px;max-width:calc(100vw - 40px);max-height:calc(100vh - 40px);");let Ve=class extends D.Component{constructor(){super(...arguments),this.viewStore=this.props.chatViewStore}handleChannelActivate(e){this.viewStore.setRoute({type:"channel",id:e}),this.viewStore.navigator.hide()}handleClick(){this.viewStore.closeCharacterMenu()}handleContextMenu(e){const t=e.target;t instanceof HTMLElement&&t.dataset&&t.dataset.character&&(e.preventDefault(),this.viewStore.openCharacterMenu(t.dataset.character,e.clientX,e.clientY))}renderRoute(){const{route:e}=this.viewStore;return"channel"===e.type?D.createElement(we,{id:e.id}):"private-chat"===e.type?D.createElement(Le,{partner:e.partner}):D.createElement(Q,null,D.createElement("h3",null,"next"))}renderSidebarMenu(){return D.createElement(X,{className:"flex-row"},this.renderMenu(),D.createElement("div",{className:"divider-h"}))}renderMenu(){return D.createElement(_e,null)}renderDrawerMenu(){const{navigator:e}=this.viewStore;return D.createElement(y,{side:"left",visible:e.isOpen,onShadeClicked:e.hide},this.renderMenu())}renderChannelBrowser(){const{channelBrowser:e}=this.viewStore;return D.createElement(Oe,{visible:e.isOpen},D.createElement(S,{onShadeClick:e.hide},D.createElement(Re,{className:"bg-color-main"},D.createElement(W,{onDone:e.hide}))))}renderStatusMenu(){const{statusMenu:e}=this.viewStore;return D.createElement(Oe,{visible:e.isOpen},D.createElement(S,{onShadeClick:e.hide},D.createElement(Fe,null)))}renderFriendBrowser(){const{friendBrowser:e}=this.viewStore;return D.createElement(Oe,{visible:e.isOpen},D.createElement(S,{onShadeClick:e.hide},D.createElement(Te,null)))}renderCharacterMenu(){const e=this.viewStore.characterMenu,{open:t}=e,n=U.c(e,["open"]);return D.createElement(Oe,{visible:t},D.createElement(je,Object.assign({},n)))}render(){return D.createElement("main",{className:"bg-color-darken-3 fullscreen flex-row",onClick:this.handleClick,onContextMenu:this.handleContextMenu},this.renderSidebarMenu(),D.createElement("section",{className:"flex-grow flex-column"},this.renderRoute()),this.renderDrawerMenu(),this.renderChannelBrowser(),this.renderStatusMenu(),this.renderFriendBrowser(),this.renderCharacterMenu())}};U.b([A.action.bound],Ve.prototype,"handleChannelActivate",null),U.b([A.action.bound],Ve.prototype,"handleClick",null),U.b([A.action.bound],Ve.prototype,"handleContextMenu",null),Ve=U.b([Object(P.inject)("chatStore","chatViewStore","channelStore"),P.observer],Ve);const Ke=Object(P.observer)(function(e){return D.createElement(Oe,{visible:e.overlay.isOpen},D.createElement(S,null,D.createElement("div",{className:"bg-color-main text-center padding scroll-v",style:{width:"300px",maxWidth:"calc(100vw - 40px)",maxHeight:"calc(100vh - 40px)"}},D.createElement("h2",null,"next"," v","0.12.1"),D.createElement("p",null,"Thanks for testing this early beta! I put a lot of work into this over the past few months, so I hope you'll like it!"),D.createElement("p",null,"Keep in mind: some features may be missing, or even ",D.createElement("strong",null,"horribly")," broken, so use at your own risk!"),D.createElement("p",null,D.createElement("a",{className:"bbc-link",href:"https://github.com/kingdaro/next",target:"_blank"},"Project page on GitHub")),D.createElement("p",null,"If you find a bug or have a suggestion not listed on the project page, make an issue for it on GitHub, or",D.createElement("a",{className:"bbc-link",href:"https://www.f-list.net/c/next-dev/",target:"_blank"},"send me a note here.")),D.createElement("p",null,D.createElement("button",{onClick:e.overlay.hide},"I understand. Show me the thing.")))))}),ze={width:"100px",height:"100px"};let Ge=class extends D.Component{constructor(){super(...arguments),this.character="",this.storedCharacter=new J("CharacterSelect_character")}handleSubmit(){this.props.onSubmit(this.character)}handleChange(e){this.character=e.currentTarget.value,this.storedCharacter.save(this.character).catch(console.error)}componentDidMount(){return U.a(this,void 0,void 0,function*(){const e=yield this.storedCharacter.restore();this.character=e||""})}render(){return D.createElement("section",{className:"text-center"},D.createElement("h1",null,"Choose your identity."),D.createElement("p",null,D.createElement("img",{style:ze,src:d(this.character),alt:`Avatar for ${this.character}`})),D.createElement("form",{onSubmit:s(this.handleSubmit)},D.createElement("fieldset",null,D.createElement("select",{value:this.character,onChange:this.handleChange},this.props.characters.map(e=>D.createElement("option",{key:e},e)))),D.createElement("fieldset",null,D.createElement("button",{type:"submit"},"Submit"))),D.createElement("p",null,D.createElement("a",{href:"#",className:"bbc-link",onClick:s(this.props.onBack)},"Back")))}};U.b([A.observable],Ge.prototype,"character",void 0),U.b([V.bind],Ge.prototype,"handleSubmit",null),U.b([A.action.bound],Ge.prototype,"handleChange",null),Ge=U.b([P.observer],Ge);let We=class extends D.Component{constructor(){super(...arguments),this.username="",this.password="",this.storedUsername=new J("Login_username")}handleSubmit(){this.props.onSubmit(this.username,this.password)}handleUsernameInput(e){this.username=e.currentTarget.value,this.storedUsername.save(this.username).catch(console.error)}handlePasswordInput(e){this.password=e.currentTarget.value}componentDidMount(){return U.a(this,void 0,void 0,function*(){const e=yield this.storedUsername.restore();this.username=e||""})}render(){return D.createElement("section",{className:"text-center"},D.createElement("h1",{className:"margin"},"Hello, beautiful."),D.createElement("form",{onSubmit:s(this.handleSubmit)},D.createElement("fieldset",null,D.createElement("input",{type:"text",placeholder:"Username",value:this.username,onInput:this.handleUsernameInput})),D.createElement("fieldset",null,D.createElement("input",{type:"password",placeholder:"Password",value:this.password,onInput:this.handlePasswordInput})),D.createElement("fieldset",null,D.createElement("button",{type:"submit"},"Submit"))),D.createElement("p",null,this.props.statusText),D.createElement("p",null,D.createElement("a",{className:"bbc-link",href:"#",onClick:this.props.onAbout},"About")))}};U.b([A.observable],We.prototype,"username",void 0),U.b([A.observable],We.prototype,"password",void 0),U.b([V.bind],We.prototype,"handleSubmit",null),U.b([A.action.bound],We.prototype,"handleUsernameInput",null),U.b([A.action.bound],We.prototype,"handlePasswordInput",null),We=U.b([P.observer],We);let Xe=class extends D.Component{constructor(){super(...arguments),this.appStore=this.props.appStore,this.authStore=this.props.authStore,this.chatStore=this.props.chatStore,this.loginStatus=""}handleLoginSubmit(e,t){return U.a(this,void 0,void 0,function*(){try{this.loginStatus="Logging in...",yield this.authStore.fetchTicket(e,t),yield this.authStore.fetchCharacters(),this.authStore.saveAuthData().catch(console.error),this.appStore.setState(_.characterSelect),this.loginStatus=""}catch(e){this.loginStatus=e.message||e.toString()}})}handleCharacterSubmit(e){const{account:t,ticket:n}=this.authStore;this.appStore.setState(_.connecting),this.chatStore.connectToServer(t,n,e,this.handleConnect,this.handleDisconnect)}handleConnect(){this.appStore.setState(_.online)}handleDisconnect(){this.appStore.init().catch(console.error)}backToLogin(){this.appStore.setState(_.login)}renderCurrentView(){switch(this.appStore.state){case _.setup:return D.createElement(a,{text:"Setting things up..."});case _.login:return D.createElement(We,{statusText:this.loginStatus,onSubmit:this.handleLoginSubmit,onAbout:this.appStore.appInfo.show});case _.characterSelect:return D.createElement(Ge,{characters:this.authStore.characters,onSubmit:this.handleCharacterSubmit,onBack:this.backToLogin});case _.connecting:return D.createElement(a,{text:"Connecting..."});case _.online:return D.createElement(Ve,null)}}render(){return D.createElement("main",{className:"fullscreen flex-center bg-color-main text-color-main"},this.renderCurrentView(),D.createElement(Ke,{overlay:this.appStore.appInfo}))}};U.b([A.observable],Xe.prototype,"loginStatus",void 0),U.b([A.action.bound],Xe.prototype,"handleLoginSubmit",null),U.b([A.action.bound],Xe.prototype,"handleCharacterSubmit",null),U.b([A.action.bound],Xe.prototype,"handleConnect",null),U.b([A.action.bound],Xe.prototype,"handleDisconnect",null),U.b([A.action.bound],Xe.prototype,"backToLogin",null),Xe=U.b([Object(P.inject)("appStore","authStore","chatStore"),P.observer],Xe);class Ye{constructor(){this.account="",this.ticket="",this.characters=[]}fetchTicket(e,t){return U.a(this,void 0,void 0,function*(){const n=yield c(e,t);this.account=e,this.ticket=n})}fetchCharacters(){return U.a(this,void 0,void 0,function*(){const{account:e,ticket:t}=this;this.characters=yield l(e,t)})}loadAuthData(){return U.a(this,void 0,void 0,function*(){const e=yield B.a.getItem("AuthStore_auth");e&&(this.account=e.account,this.ticket=e.ticket)})}saveAuthData(){return U.a(this,void 0,void 0,function*(){const{account:e,ticket:t}=this;yield B.a.setItem("AuthStore_auth",{account:e,ticket:t})})}}class qe{constructor(e,t,n,r){this.type=e,this.id=t,this.title=n,this.userCount=r}}class Qe{constructor(){this.publicChannels=[],this.privateChannels=[]}setPublicChannels(e){this.publicChannels=e}setPrivateChannels(e){this.privateChannels=e}handleSocketCommand(e,t){"CHA"===e?this.setPublicChannels(M(t.channels)):"ORS"===e&&this.setPrivateChannels(M(t.channels))}}U.b([A.observable],Qe.prototype,"publicChannels",void 0),U.b([A.observable],Qe.prototype,"privateChannels",void 0),U.b([A.action],Qe.prototype,"setPublicChannels",null),U.b([A.action],Qe.prototype,"setPrivateChannels",null),U.b([A.action],Qe.prototype,"handleSocketCommand",null);class Ze{constructor(e){this.id=e,this.title=this.id,this.description="",this.users=[],this.messages=[],this.ops=[],this.mode="both",this.selectedMode="both"}setUsers(e){this.users=e}addUser(e){this.users.push(e)}removeUser(e){const t=this.users.indexOf(e);t>-1&&this.users.splice(t,1)}getUsers(){return this.users}getUserCount(){return this.users.length}}U.b([A.observable],Ze.prototype,"title",void 0),U.b([A.observable],Ze.prototype,"description",void 0),U.b([A.observable],Ze.prototype,"users",void 0),U.b([A.observable],Ze.prototype,"messages",void 0),U.b([A.observable],Ze.prototype,"ops",void 0),U.b([A.observable],Ze.prototype,"mode",void 0),U.b([A.observable],Ze.prototype,"selectedMode",void 0),U.b([A.action],Ze.prototype,"setUsers",null),U.b([A.action],Ze.prototype,"addUser",null),U.b([A.action],Ze.prototype,"removeUser",null);class et{constructor(e,t,n){this.sender=e,this.text=t,this.type=n,this.date=new Date}}class tt{constructor(){this.channels=new Map,this.joinedChannels=new Map,this.storedChannels=new J("ChannelStore_joinedChannels")}getChannel(e){let t=this.channels.get(e);return t||(t=new Ze(e),this.channels.set(e,t)),t}addJoinedChannel(e){this.joinedChannels.set(e,!0)}removeJoinedChannel(e){this.joinedChannels.delete(e)}handleSocketCommand(e,t){if("FLN"===e&&this.channels.forEach(e=>{e.removeUser(t.character)}),"JCH"===e){const e=this.getChannel(t.channel),n=t.character.identity;e.title=t.title,e.addUser(n)}if("LCH"===e&&this.getChannel(t.channel).removeUser(t.character),"ICH"===e){const e=this.getChannel(t.channel),n=t.users;e.setUsers(n.map(e=>e.identity)),e.mode=t.mode}"CDS"===e&&(this.getChannel(t.channel).description=t.description),"COL"===e&&(this.getChannel(t.channel).description=t.oplist),"MSG"===e&&this.getChannel(t.channel).messages.push(new et(t.character,t.message,"normal")),"LRP"===e&&this.getChannel(t.channel).messages.push(new et(t.character,t.message,"lfrp"))}getJoinedChannels(){return Array.from(this.joinedChannels.keys()).map(e=>this.getChannel(e))}isJoined(e){return this.joinedChannels.has(e)}saveJoinedChannels(e){return U.a(this,void 0,void 0,function*(){const t=this.getJoinedChannels().map(e=>e.id),n=(yield this.storedChannels.restore())||{};yield this.storedChannels.save(Object.assign({},n,{[e]:t}))})}restoreJoinedChannels(e){return U.a(this,void 0,void 0,function*(){const t=yield this.storedChannels.restore();return t?t[e]||[]:[]})}}U.b([A.observable],tt.prototype,"channels",void 0),U.b([A.observable],tt.prototype,"joinedChannels",void 0),U.b([A.action],tt.prototype,"getChannel",null),U.b([A.action],tt.prototype,"addJoinedChannel",null),U.b([A.action],tt.prototype,"removeJoinedChannel",null),U.b([A.action],tt.prototype,"handleSocketCommand",null);class nt{constructor(e,t,n,r=""){this.name=e,this.gender="",this.status="",this.statusMessage="",this.gender=t,this.status=n,this.statusMessage=r}}U.b([A.observable],nt.prototype,"gender",void 0),U.b([A.observable],nt.prototype,"status",void 0),U.b([A.observable],nt.prototype,"statusMessage",void 0);class rt{constructor(){this.characters=A.observable.map()}getCharacter(e){let t=this.characters.get(e);return t||(t=new nt(e,"None","offline"),this.characters.set(e,t)),t}handleCharacterBatch(e){const t={};e.forEach(([e,n,r,a])=>{const s=this.characters.get(e);s?(s.gender=n,s.status=r,s.statusMessage=a):t[e]=new nt(e,n,r,a)}),this.characters.merge(t)}handleSocketCommand(e,t){if("LIS"===e&&this.handleCharacterBatch(t.characters),"NLN"===e){const e=this.getCharacter(t.identity);e.gender=t.gender,e.status="online"}if("FLN"===e&&(this.getCharacter(t.character).status="offline"),"STA"===e){const e=this.getCharacter(t.character);e.status=t.status,e.statusMessage=t.statusmsg}}}U.b([A.action],rt.prototype,"getCharacter",null),U.b([A.action],rt.prototype,"handleCharacterBatch",null),U.b([A.action],rt.prototype,"handleSocketCommand",null);var at=n(181),st=n.n(at);class it{constructor(e,t,n,r){this.channels=e,this.privateChats=t,this.characters=n,this.channelList=r,this.identity="",this.friends=A.observable.map(),this.admins=A.observable.map(),this.ignored=A.observable.map(),this.commandHandlers=[this,this.channels,this.privateChats,this.characters,this.channelList]}connectToServer(e,t,n,r,a){this.disconnectFromServer(),this.identity=n,this.socket=new WebSocket("wss://chat.f-list.net:9799");const s=()=>{this.disconnectFromServer(),a()};this.socket.addEventListener("open",()=>{const r={account:e,ticket:t,character:n,cname:"next",cversion:"0.12.1",method:"ticket"};this.sendSocketCommand("IDN",r)}),this.socket.addEventListener("message",e=>{const t=e.data,n=t.slice(0,3),a=t.length>3?JSON.parse(t.slice(4)):{};"IDN"===n&&r(),this.commandHandlers.forEach(e=>{e.handleSocketCommand(n,a)})}),this.socket.addEventListener("close",s),this.socket.addEventListener("error",s)}disconnectFromServer(){this.socket&&this.socket.close(),this.socket=void 0}sendSocketCommand(e,t){this.socket&&(t?this.socket.send(e+" "+JSON.stringify(t)):this.socket.send(e))}handleSocketCommand(e,t){const n={PIN(){this.sendSocketCommand("PIN")},IDN(){console.info("Successfully connected to server"),this.restoreJoinedChannels().catch(console.error),this.restorePrivateChats().catch(console.error)},HLO(){console.info(t.message)},CON(){console.info(`There are ${t.count} characters in chat`)},FRL(){const e=t.characters;this.friends.merge(st()(e.map(e=>[e,!0])))},IGN(){const{action:e}=t;if("init"===e){const e=t.characters;this.ignored.merge(st()(e.map(e=>[e,!0])))}else"add"===e?this.ignored.set(t.character,!0):"delete"===e&&this.ignored.delete(t.character)},ADL(){const e=t.ops;this.admins.merge(st()(e.map(e=>[e,!0])))},JCH(){t.character.identity===this.identity&&(this.channels.addJoinedChannel(t.channel),this.saveJoinedChannels().catch(console.error))},LCH(){t.character===this.identity&&(this.channels.removeJoinedChannel(t.channel),this.saveJoinedChannels().catch(console.error))},RTB(){}};n[e]&&n[e].call(this)}fetchChannelList(){this.sendSocketCommand("CHA"),this.sendSocketCommand("ORS")}joinChannel(e){this.sendSocketCommand("JCH",{channel:e})}leaveChannel(e){this.sendSocketCommand("LCH",{channel:e})}sendChannelMessage(e,t){this.sendSocketCommand("MSG",{channel:e,message:t});const n=this.channels.getChannel(e);n&&n.messages.push(new et(this.identity,t,"normal"))}saveJoinedChannels(){return U.a(this,void 0,void 0,function*(){yield this.channels.saveJoinedChannels(this.identity)})}restoreJoinedChannels(){return U.a(this,void 0,void 0,function*(){(yield this.channels.restoreJoinedChannels(this.identity)).forEach(e=>{this.joinChannel(e)})})}openPrivateChat(e){this.privateChats.openPrivateChat(e),this.savePrivateChats().catch(console.error)}removePrivateChat(e){this.privateChats.closePrivateChat(e),this.savePrivateChats().catch(console.error)}sendPrivateMessage(e,t){this.sendSocketCommand("PRI",{recipient:e,message:t}),this.privateChats.getPrivateChat(e).messages.push(new et(this.identity,t,"normal"))}savePrivateChats(){return U.a(this,void 0,void 0,function*(){yield this.privateChats.savePrivateChats(this.identity)})}restorePrivateChats(){return U.a(this,void 0,void 0,function*(){(yield this.privateChats.restorePrivateChats(this.identity)).forEach(this.openPrivateChat.bind(this))})}updateStatus(e,t){this.sendSocketCommand("STA",{status:e,statusmsg:t})}ignore(e){this.sendSocketCommand("IGN",{action:"add",character:e})}unignore(e){this.sendSocketCommand("IGN",{action:"delete",character:e})}isIgnored(e){return this.ignored.has(e)}get identityCharacter(){return this.characters.getCharacter(this.identity)}}U.b([A.observable],it.prototype,"identity",void 0),U.b([A.observable],it.prototype,"friends",void 0),U.b([A.observable],it.prototype,"admins",void 0),U.b([A.action],it.prototype,"connectToServer",null),U.b([A.action],it.prototype,"disconnectFromServer",null),U.b([A.action],it.prototype,"handleSocketCommand",null),U.b([A.action],it.prototype,"sendChannelMessage",null),U.b([A.action],it.prototype,"openPrivateChat",null),U.b([A.action],it.prototype,"removePrivateChat",null),U.b([A.action],it.prototype,"sendPrivateMessage",null),U.b([A.computed],it.prototype,"identityCharacter",null);class ot{constructor(){this.navigator=new $,this.channelBrowser=new $,this.statusMenu=new $,this.friendBrowser=new $,this.route={type:"none"},this.characterMenu={open:!1,x:0,y:0,character:""}}setRoute(e){this.route=e}openCharacterMenu(e,t,n){this.characterMenu.character=e,this.characterMenu.x=t,this.characterMenu.y=n,this.characterMenu.open=!0}closeCharacterMenu(){this.characterMenu.open=!1}}U.b([A.observable],ot.prototype,"route",void 0),U.b([A.observable],ot.prototype,"characterMenu",void 0),U.b([A.action.bound],ot.prototype,"setRoute",null),U.b([A.action],ot.prototype,"openCharacterMenu",null),U.b([A.action.bound],ot.prototype,"closeCharacterMenu",null);class ct{constructor(e){this.partner=e,this.messages=[]}}U.b([A.observable],ct.prototype,"messages",void 0);class lt{constructor(){this.privateChats=A.observable.map(),this.openPrivateChats=A.observable.map(),this.storedPrivateChats=new J("PrivateChatStore_privateChats")}getPrivateChat(e){let t=this.privateChats.get(e);return t||(t=new ct(e),this.privateChats.set(e,t)),t}openPrivateChat(e){return this.openPrivateChats.set(e,!0),this.getPrivateChat(e)}closePrivateChat(e){this.openPrivateChats.delete(e)}handleSocketCommand(e,t){"PRI"===e&&this.openPrivateChat(t.character).messages.push(new et(t.character,t.message,"normal"))}getOpenPrivateChats(){return Array.from(this.openPrivateChats.keys()).map(e=>this.getPrivateChat(e))}savePrivateChats(e){return U.a(this,void 0,void 0,function*(){const t=(yield this.storedPrivateChats.restore())||{},n=Object.assign({},t,{[e]:Array.from(this.openPrivateChats.keys())});yield this.storedPrivateChats.save(n)})}restorePrivateChats(e){return U.a(this,void 0,void 0,function*(){return((yield this.storedPrivateChats.restore())||{})[e]||[]})}}U.b([A.action],lt.prototype,"getPrivateChat",null),U.b([A.action],lt.prototype,"openPrivateChat",null),U.b([A.action],lt.prototype,"closePrivateChat",null),U.b([A.action],lt.prototype,"handleSocketCommand",null);const ht=new tt,dt=new lt,pt=new rt,ut=new Qe,mt=new it(ht,dt,pt,ut),bt=new ot,vt=new Ye,gt={appStore:new F(vt),authStore:vt,channelBrowserStore:ut,channelStore:ht,characterStore:pt,chatStore:mt,chatViewStore:bt,privateChatStore:dt},Ct=!1;O(),gt.appStore.init().catch(console.error),Ct&&(window.stores=gt)},57:function(e,t){},70:function(e,t){}},[56]);