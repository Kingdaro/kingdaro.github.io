webpackJsonp([1],{180:function(e,t){},56:function(e,t,n){"use strict";function r(e){const{size:t=16,name:n,style:r}=e,s=U.c(e,["size","name","style"]),a=`public/icons/${n}.svg`,i=Object.assign({width:t+"px",height:t+"px",display:"inline-block",lineHeight:0,cursor:"inherit",verticalAlign:"middle"},r);return T.createElement("img",Object.assign({src:a,style:i},s))}function s(e){return T.createElement("div",{className:"Loading-shade fullscreen flex-column flex-center"},T.createElement("div",null,T.createElement(r,{name:"paw",size:100,className:"Loading-icon"})),T.createElement("h2",{className:"Loading-text"},e.text))}function a(e){return t=>{t.preventDefault(),e&&e(t)}}function i(e){return t=>{t.stopPropagation(),e&&e(t)}}function o(e){const{text:t,active:n,children:r}=e,s=U.c(e,["text","active","children"]);return T.createElement("a",Object.assign({href:"#",className:`margin-left margin-right block ${e.active?"":"faded"}`},s),e.text)}function c(e,t={}){const n=e+"?"+ae.stringify(t);return fetch(n,{method:"POST"}).then(e=>e.json())}function l(e,t){return U.a(this,void 0,void 0,function*(){const n=yield c("https://www.f-list.net/json/getApiTicket.php",{account:e,password:t});if(n.error)throw new Error(n.error);return n.ticket})}function h(e,t){return U.a(this,void 0,void 0,function*(){const n=yield c("https://www.f-list.net/json/api/character-list.php",{account:e,ticket:t});if(n.error)throw new Error(n.error);return n.characters})}function d(e){return encodeURI(e.toLowerCase())}function p(e){return`https://static.f-list.net/images/avatar/${d(e)}.png`}function u(e){return`https://www.f-list.net/c/${d(e)}`}function m(e){return`https://static.f-list.net/images/eicon/${d(e)}.gif`}function g(e){return ie.parse(e)}function v(e){return`<a class='bbc-icon' href='${u(e)}' target='_blank' style='${`background-image: url(${p(e)})`}'></a>`}function b(e){return`<div class='bbc-icon' style='background-image: url(${m(e)})'></div>`}function C(e){return`<a href='#' class='bbc-channel' data-channel='${e}'>`+`<i class='mdi mdi-earth'></i> ${e}`+`</a>`}function f(e,t){return`<a href='#' class='bbc-channel' data-channel='${e}'>`+`<i class='mdi mdi-key-variant'></i> ${t}`+`</a>`}function y(e,t){const{pathname:n}=Object(se.parse)(e),r=n?re.a.extname(n):"";return`<a class='bbc-link' href='${e}' target='_blank'>`+`<i class='mdi mdi-${[".png",".jpg",".jpeg",".svg",".gif"].includes(r)?"image":"link-variant"}'></i> ${t}`+`</a>`}function E(e){const t=e.visible?"overlay-visible":"overlay-hidden",n="overlay-panel overlay-panel-"+e.side;return T.createElement(ce,{className:`fullscreen ${t}`,onClick:a(()=>{e.onShadeClicked&&e.onShadeClicked()})},T.createElement(le,{className:`${n} bg-color-main flex-row`,onClick:i()},e.children))}function S(e){switch(e){case"normal":return"";case"lfrp":return"highlight-green";case"admin":return"highlight-red";case"system":return""}}function w(e){const t=a(()=>{e.onShadeClick&&e.onShadeClick()});return T.createElement("div",{className:"Overlay-shade",onClick:t},T.createElement("div",{className:"Overlay-panel",onClick:i()},e.children))}function x(e){return T.createElement(De,{href:"#",className:"padding block no-line-height",onClick:a(e.onClick)},T.createElement(r,{name:e.icon,size:32}))}function k(e){const{title:t,type:n}=e,s="public"===n?"earth":"key";return T.createElement("div",{className:"flex-row flex-align-center"},T.createElement(r,{name:s,className:"margin-right"})," ",T.createElement("span",null,t))}function N(e){const t=e.active?"bg-color-main":"";return T.createElement(Te,{className:`${t} flex-row flex-align-stretch`,active:e.active},T.createElement("a",{href:"#",className:"flex-grow padding",onClick:a(e.onActivate)},e.children),T.createElement(Ae,{href:"#",className:"flex-center padding no-line-height"},T.createElement(r,{name:"close",onClick:a(e.onClose)})))}function M(e){return T.createElement("div",{className:"flex-row flex-align-center"},T.createElement("img",{src:p(e.partner),className:"margin-right",style:{width:"24px",height:"24px",verticalAlign:"middle"}}),e.partner)}function j(e){return e.map(e=>new Qe("public",e.name,e.title||e.name,e.characters))}function O(){return T.createElement("div",null,T.createElement(L.Provider,Object.assign({},Ct),T.createElement(Ye,null)),ft&&T.createElement(D.a,{position:{right:0,bottom:0}}))}function P(){A.render(T.createElement(O,null),document.getElementById("root"))}Object.defineProperty(t,"__esModule",{value:!0});n(57);var L=n(3),I=n(69),D=n.n(I),T=n(0),A=n(13),U=n(1),$=n(2);n(70);class H{constructor(e=!1){this.visible=e}show(){this.visible=!0}hide(){this.visible=!1}toggle(){this.visible=!this.visible}get isOpen(){return this.visible}}U.b([$.observable],H.prototype,"visible",void 0),U.b([$.action.bound],H.prototype,"show",null),U.b([$.action.bound],H.prototype,"hide",null),U.b([$.action.bound],H.prototype,"toggle",null),U.b([$.computed],H.prototype,"isOpen",null);var B=n(38),R=n.n(B);class J{constructor(e){this.storageKey=e}save(e){return U.a(this,void 0,void 0,function*(){return B.setItem(this.storageKey,e)})}restore(){return U.a(this,void 0,void 0,function*(){return B.getItem(this.storageKey)})}}var _;!function(e){e[e.setup=0]="setup",e[e.login=1]="login",e[e.characterSelect=2]="characterSelect",e[e.connecting=3]="connecting",e[e.online=4]="online"}(_=_||(_={}));class F{constructor(e){this.auth=e,this.state=_.setup,this.appInfo=new H,this.hasRun=new J("AppStore_hasRun")}setState(e){this.state=e}init(){return U.a(this,void 0,void 0,function*(){try{yield this.auth.loadAuthData(),yield this.auth.fetchCharacters(),this.setState(_.characterSelect)}catch(e){this.setState(_.login)}(yield this.hasRun.restore())||(yield this.hasRun.save(!0),this.appInfo.show())})}}U.b([$.observable],F.prototype,"state",void 0),U.b([$.action],F.prototype,"setState",null),U.b([$.action.bound],F.prototype,"init",null);var V=n(4),K=n(26),z=n(14),G=n.n(z);const W=Object(V.a)("a")("> *{vertical-align:text-bottom;}");let X=class extends T.Component{constructor(){super(...arguments),this.store=this.props.channelBrowserStore,this.currentList="publicChannels",this.searchText="",this.handleSearchInput=(e=>{this.setSearchText(e.currentTarget.value)}),this.renderChanelListEntry=(e=>{const t=this.props.channelStore.isJoined(e.id)?"bg-color-main":"faded";return T.createElement("a",{key:e.id,href:"#",className:`flex-row ${t}`,onClick:()=>this.toggleChannel(e.id)},T.createElement("div",{className:"padding flex-grow",dangerouslySetInnerHTML:{__html:e.title}}),T.createElement("div",{className:"padding"},e.userCount))})}setCurrentList(e){this.currentList=e}setSearchText(e){this.searchText=e}toggleChannel(e){const t=this.props.chatStore;this.props.channelStore.isJoined(e)?t.leaveChannel(e):t.joinChannel(e)}get publicChannels(){return this.sortChannels(this.filterChannels(this.store.publicChannels))}get privateChannels(){return this.sortChannels(this.filterChannels(this.store.privateChannels))}sortChannels(e){return G()(e,e=>e.title.toLowerCase())}filterChannels(e){const t=this.searchText.trim().toLowerCase();return t.length>0?e.filter(e=>e.title.toLowerCase().includes(t)):e}render(){return T.createElement("div",{className:"flex-column fill-area bg-color-darken-1"},T.createElement("div",{className:"flex-row"},this.renderTab("Public","earth","publicChannels"),this.renderTab("Private","key","privateChannels")),T.createElement("div",{className:"flex-grow scroll-v"},this.renderChannels(this.publicChannels,"publicChannels"),this.renderChannels(this.privateChannels,"privateChannels")),T.createElement("div",{className:"flex-row padding bg-color-main"},T.createElement("input",{className:"flex-grow margin-right",type:"text",placeholder:"Search...",onInput:this.handleSearchInput}),T.createElement("button",{onClick:a(this.props.onDone)},"Done")))}renderTab(e,t,n){const s=`flex-grow flex-row flex-align-center padding ${this.currentList===n?"bg-color-main":"faded"}`;return T.createElement(W,{href:"#",className:s,onClick:()=>this.setCurrentList(n)},T.createElement(r,{name:t,size:24,className:"margin-right"})," ",e)}renderChannels(e,t){return T.createElement("div",{style:{display:this.currentList===t?void 0:"none"}},e.map(this.renderChanelListEntry))}};U.b([$.observable],X.prototype,"currentList",void 0),U.b([$.observable],X.prototype,"searchText",void 0),U.b([$.action],X.prototype,"setCurrentList",null),U.b([Object(K.debounce)(800)],X.prototype,"setSearchText",null),U.b([$.action],X.prototype,"toggleChannel",null),U.b([$.computed],X.prototype,"publicChannels",null),U.b([$.computed],X.prototype,"privateChannels",null),X=U.b([Object(L.inject)("chatStore","channelStore","channelBrowserStore"),L.observer],X);const Y=Object(V.a)("div")("@media (max-width:750px){display:none;}"),q=Object(V.a)("div")("@media (min-width:750px){display:none;}"),Q=Object(V.a)("div")(">:not(:last-child){margin-right:8px;}");let Z=class extends T.Component{render(){return T.createElement(Q,{className:"bg-color-darken-2 flex-row flex-align-center padding"},T.createElement(q,{className:"no-line-height"},T.createElement("a",{href:"#",onClick:this.props.chatViewStore.navigator.toggle},T.createElement(r,{name:"menu",size:24}))),T.createElement("div",{className:"flex-grow"},this.props.children))}};Z=U.b([Object(L.inject)("chatViewStore"),L.observer],Z);let ee=class extends T.Component{constructor(){super(...arguments),this.message=""}handleInput(e){this.message=e.currentTarget.value}handleKeyDown(e){if("Enter"===e.key&&!e.ctrlKey&&!e.shiftKey){e.preventDefault();const t=this.message.trim();t.length>0&&this.props.onMessage&&this.props.onMessage(t),this.message=""}}render(){const e=this.props,{className:t,onMessage:n}=e,r=U.c(e,["className","onMessage"]);return T.createElement("div",Object.assign({className:`flex-row padding ${t}`},r),T.createElement("textarea",{className:"flex-grow padding margin-right",placeholder:"Say something...",style:{resize:"none"},value:this.message,onInput:this.handleInput,onKeyDown:this.handleKeyDown}),T.createElement("button",{style:{width:"80px"}},"Send"))}};U.b([$.observable],ee.prototype,"message",void 0),U.b([$.action.bound],ee.prototype,"handleInput",null),U.b([$.action.bound],ee.prototype,"handleKeyDown",null),ee=U.b([L.observer],ee);var te=n(172),ne=n(173),re=n.n(ne),se=n(175),ae=n(55);const ie=Object(te.createParser)({b:{render:e=>`<span class="bbc-bold">${e}</span>`},i:{render:e=>`<span class="bbc-italic">${e}</span>`},u:{render:e=>`<span class="bbc-underline">${e}</span>`},s:{render:e=>`<span class="bbc-strike">${e}</span>`},sup:{render:e=>`<span class="bbc-super">${e}</span>`},sub:{render:e=>`<span class="bbc-sub">${e}</span>`},url:{render:(e,t)=>y(t,e)},color:{render:(e,t)=>t?`<span class="bbc-color-${t}">${e}</span>`:e},noparse:{render:e=>e,deep:!1},icon:{render:e=>v(e)},eicon:{render:e=>b(e)},user:{render:e=>v(e)},session:{render:(e,t)=>f(e,t)},channel:{render:e=>C(e)}});class oe extends T.Component{constructor(){super(...arguments),this.shouldScroll=!1}componentWillUpdate(){const e=A.findDOMNode(this);e.scrollTop+e.clientHeight===e.scrollHeight&&(this.shouldScroll=!0)}componentDidUpdate(){if(this.shouldScroll){const e=A.findDOMNode(this);e.scrollTop=e.scrollHeight,this.shouldScroll=!1}}render(){return T.Children.only(this.props.children)}}const ce=Object(V.a)("div")("background-color:rgba(0,0,0,0.5);transition:0.3s;> .overlay-panel{transition:0.3s;}&.overlay-hidden{opacity:0;visibility:hidden;> .overlay-panel-left{transform:translateX(-100%);}> .overlay-panel-right{transform:translateX(100%);}}&.overlay-visible{opacity:1;visibility:visible;> .overlay-panel{transform:translateX(0%);}}"),le=Object(V.a)("div")("position:absolute;top:0;bottom:0;box-shadow:0px 0px 8px black;&.overlay-panel-left{left:0;}&.overlay-panel-right{right:0;}"),he=Object(V.a)("span")("line-height:0;font-size:120%;vertical-align:middle;"),de=Object(L.inject)("characterStore")(Object(L.observer)(function(e){const{name:t}=e,{gender:n,status:r}=e.characterStore.getCharacter(t),s="character-gender-"+n.toLowerCase(),a="character-status-"+r.toLowerCase();return T.createElement("a",{href:u(t),target:"_blank",className:`${s} text-bold`,"data-character":t},T.createElement(he,{className:a,title:r},"•")," ",t)})),pe=/^\s*\/me\s*/,ue=Object(V.a)("div")("&:nth-child(2n){background-color:rgba(0,0,0,0.15);}"),me=Object(L.inject)(function(e,t){const{sender:n}=t.message;return{isSenderIgnored:e.chatStore.isIgnored(n)}})(Object(L.observer)(function(e){if(e.isSenderIgnored)return null;const{sender:t,text:n,type:r,date:s}=e.message,a=n.trim().startsWith("/me"),i=g(n.replace(pe,"")),o=a?"text-italic":"",c=S(r);return T.createElement(ue,{className:`${o}`},T.createElement("div",{className:`padding ${c}`},T.createElement("span",{className:"margin-left text-small text-italic faded float-right"},"[",s.toLocaleTimeString(),"]"),T.createElement("span",{className:"margin-right"},T.createElement(de,{name:t})),T.createElement("span",{className:`preserve-ws`,dangerouslySetInnerHTML:{__html:i}})))})),ge=Object(V.a)("div")("padding:4px 8px;");let ve=class extends T.Component{constructor(){super(...arguments),this.renderUser=(e=>T.createElement(ge,{className:`${this.getHighlightClass(e)}`,key:e},T.createElement(de,{name:e})))}get unignoredUsers(){const e=this.props.chatStore;return this.props.users.filter(t=>!e.isIgnored(t))}get sortedUsers(){const{characterStore:e,chatStore:t}=this.props;return G()(this.unignoredUsers,n=>{const r=e.getCharacter(n),{friends:s,admins:a}=t;return a[n]?0:this.props.ops.includes(n)?1:s[n]?2:"looking"===r.status?3:4},e=>e.toLowerCase())}getHighlightClass(e){const{chatStore:t}=this.props,{friends:n,admins:r}=t;return r[e]?"highlight-red":this.props.ops.includes(e)?"highlight-yellow":n[e]?"highlight-blue":""}render(){return T.createElement("div",null,this.sortedUsers.map(this.renderUser))}};U.b([$.computed],ve.prototype,"unignoredUsers",null),U.b([$.computed],ve.prototype,"sortedUsers",null),ve=U.b([Object(L.inject)("characterStore","chatStore"),L.observer],ve);const be=Object(V.a)("div")("display:grid;grid-gap:4px;// on mobile\n  @media (max-width:750px){grid-template-rows:auto 1fr 80px;grid-template-columns:1fr;grid-template-areas:'chat-header' 'message-list' 'chat-input';}// on desktop\n  @media (min-width:750px){grid-template-rows:auto 80px 1fr 80px;grid-template-columns:1fr 200px;grid-template-areas:'chat-header chat-header' 'description description'\n      'message-list user-list' 'chat-input chat-input';}"),Ce=Object(V.a)("div")("grid-area:chat-header;"),fe=Object(V.a)("div")("grid-area:message-list;"),ye=Object(V.a)(Y)("grid-area:description;height:80px;"),Ee=Object(V.a)(Y)("grid-area:user-list;"),Se=Object(V.a)("div")("grid-area:chat-input;");let we=class extends T.Component{constructor(){super(...arguments),this.displayedMode="both",this.infoDrawer=new H,this.renderMessage=((e,t)=>T.createElement(me,{key:t,message:e}))}setDisplayedMode(e){this.displayedMode=e}get parsedDescription(){return{__html:g(this.props.channel.description)}}get filteredMessages(){const{messages:e}=this.props.channel;return"both"!==this.props.channel.mode?e:"ads"===this.displayedMode?e.filter(e=>"lfrp"===e.type):"chat"===this.displayedMode?e.filter(e=>"normal"===e.type):e}renderModeFilter(e,t){return T.createElement(o,{key:e,onClick:a(()=>this.setDisplayedMode(e)),text:t,active:this.displayedMode===e})}renderHeader(){const{channel:e}=this.props;return T.createElement(Ce,null,T.createElement(Z,null,T.createElement("div",{className:"flex-row flex-align-center"},T.createElement("h3",{className:"flex-grow"},e.title),T.createElement("div",{className:"flex-row"},"both"===e.mode&&[this.renderModeFilter("chat","Chat"),this.renderModeFilter("ads","Ads"),this.renderModeFilter("both","Both")]),T.createElement(q,null,T.createElement("a",{href:"#",onClick:a(this.infoDrawer.show)},T.createElement(r,{name:"more-vert",size:24}))))))}renderDescription(){return T.createElement(ye,{className:"bg-color-main scroll-v padding preserve-ws",dangerouslySetInnerHTML:this.parsedDescription})}renderInfoDrawer(){const{channel:e}=this.props;return T.createElement(E,{side:"right",visible:this.infoDrawer.isOpen,onShadeClicked:this.infoDrawer.hide},T.createElement("div",{className:"scroll-v",style:{width:"240px"}},T.createElement("h3",{className:"padding"},"Description"),T.createElement("div",{className:"bg-color-darken-1 padding preserve-ws",dangerouslySetInnerHTML:this.parsedDescription}),T.createElement("h3",{className:"padding"},"Users (",e.getUserCount(),")"),T.createElement("div",{className:"bg-color-darken-1"},T.createElement(ve,{users:e.getUsers(),ops:e.ops}))))}render(){const{channel:e,className:t=""}=this.props;return T.createElement(be,{className:`${t} fill-area`},this.renderHeader(),this.renderDescription(),T.createElement(oe,null,T.createElement(fe,{className:"bg-color-darken-1 flex-grow scroll-v"},this.filteredMessages.slice(0,300).map(this.renderMessage))),T.createElement(Ee,{className:"bg-color-main scroll-v"},T.createElement(ve,{users:e.users,ops:e.ops})),T.createElement(Se,{className:"bg-color-main flex-row"},T.createElement(ee,{className:"flex-grow",onMessage:this.props.onMessage})),this.renderInfoDrawer())}};U.b([$.observable],we.prototype,"displayedMode",void 0),U.b([$.action],we.prototype,"setDisplayedMode",null),U.b([$.computed],we.prototype,"parsedDescription",null),U.b([$.computed],we.prototype,"filteredMessages",null);const xe=we=U.b([Object(L.inject)(function(e,t){const{channelStore:n,chatStore:r}=e;return{channel:n.getChannel(t.id),onMessage(e){r.sendChannelMessage(t.id,e)}}}),L.observer],we),ke=Object(V.a)("img")("width:100px;height:100px;display:block;");let Ne=class extends T.Component{get character(){return this.props.characterStore.getCharacter(this.props.name)}render(){const{name:e}=this.props,{status:t,statusMessage:n}=this.character;return T.createElement("div",{className:"padding"},T.createElement("a",{href:u(e),target:"_blank"},T.createElement("h2",{style:{margin:0}},e)),T.createElement("div",{className:"spacer"}),T.createElement("a",{href:u(e),target:"_blank"},T.createElement(ke,{src:p(e),alt:`Avatar for ${e}`,key:e})),T.createElement("div",{className:"spacer"}),T.createElement("div",{className:"bg-color-darken-1 padding text-italic text-small"},T.createElement("span",{className:`character-status-${t.toLowerCase()}`},t),""!==n.trim()&&T.createElement("span",{dangerouslySetInnerHTML:{__html:" - "+g(n)}})))}};U.b([$.computed],Ne.prototype,"character",null),Ne=U.b([Object(L.inject)("characterStore"),L.observer],Ne);const Me=Object(V.a)("div")("width:200px;position:fixed;box-shadow:0px 0px 8px black;"),je=Object(V.a)("a")("opacity:0.5;&:hover{opacity:1;}");let Oe=class extends T.Component{updatePosition(){const e=A.findDOMNode(this),t=e.getBoundingClientRect(),{x:n,y:r}=this.props,s=n+t.width,a=r+t.height;e.style.left=n-Math.max(s-(window.innerWidth-16),0)+"px",e.style.top=r-Math.max(a-(window.innerHeight-16),0)+"px"}componentDidMount(){this.updatePosition()}componentDidUpdate(){this.updatePosition()}handleMessageAction(){this.props.chatStore.openPrivateChat(this.props.character)}renderIgnoreAction(){const{character:e}=this.props,t=this.props.chatStore,n=t.ignored.has(e),s=n?"remove-circle":"remove-circle-outline",a=n?"Unignore":"ignore",i=n?t.unignore:t.ignore;return T.createElement(je,{className:"padding",href:"#",onClick:i.bind(t,e)},T.createElement(r,{name:s,key:"ignore-action"})," ",a)}render(){const{character:e}=this.props;return T.createElement(Me,{className:"bg-color-darken-1 flex-column"},T.createElement("div",{className:"bg-color-main"},T.createElement(Ne,{name:e})),T.createElement(je,{className:"padding",href:"#",onClick:this.handleMessageAction},T.createElement(r,{name:"message"})," Send Message"),T.createElement(je,{className:"padding",href:u(e),target:"_blank"},T.createElement(r,{name:"link"})," Open Profile"),this.renderIgnoreAction())}};U.b([$.action.bound],Oe.prototype,"handleMessageAction",null),Oe=U.b([Object(L.inject)("chatStore"),L.observer],Oe);const Pe=Object(V.a)("div")("opacity:",e=>e.visible?1:0,";visibility:",e=>e.visible?"visible":"hidden",";transition:0.3s;");n(180);let Le=class extends T.Component{renderMessages(){const{messages:e}=this.props.privateChat;return e.map((e,t)=>T.createElement(me,{key:t,message:e}))}render(){return T.createElement("div",{className:"flex-column fill-area"},T.createElement(Z,null,T.createElement("div",{className:"flex-row"},T.createElement("h3",{className:"flex-grow"},T.createElement(de,{name:this.props.partner})),T.createElement("img",{className:"block",src:p(this.props.partner),style:{width:"24px",height:"24px"}}))),T.createElement("div",{className:"divider-v"}),T.createElement(oe,null,T.createElement("div",{className:"flex-grow bg-color-darken-1"},this.renderMessages())),T.createElement("div",{className:"divider-v"}),T.createElement("div",{className:"bg-color-main"},T.createElement(ee,{onMessage:this.props.onMessage})))}};const Ie=Le=U.b([Object(L.inject)(function(e,t){const{privateChatStore:n,chatStore:r}=e;return{privateChat:n.getPrivateChat(t.partner),onMessage(e){r.sendPrivateMessage(t.partner,e)}}}),L.observer],Le),De=Object(V.a)("a")("opacity:0.5;&:hover{opacity:1;}"),Te=Object(V.a)("div")("&:hover{opacity:",e=>e.active?1:.75,";}opacity:",e=>e.active?1:.5,";"),Ae=Object(V.a)("a")("opacity:0.3;&:hover{opacity:0.7;}");let Ue=class extends T.Component{constructor(){super(...arguments),this.renderChannelTab=(e=>{const t=this.props.currentRoute,n="channel"===t.type&&t.id===e.id;return T.createElement(N,{active:n,key:e.id,onActivate:()=>{this.props.onChannelActivate(e.id)},onClose:()=>{this.props.onChannelClose(e.id)}},T.createElement(k,{title:e.title,type:"public"}))}),this.renderPrivateChatTab=(e=>{const t=this.props.currentRoute,n="private-chat"===t.type&&t.partner===e.partner;return T.createElement(N,{key:e.partner,active:n,onActivate:()=>{this.props.onPrivateChatActivate(e.partner)},onClose:()=>{this.props.onPrivateChatClose(e.partner)}},T.createElement(M,{partner:e.partner}))})}render(){const{joinedChannels:e,privateChats:t}=this.props,n=G()(e,e=>e.title.toLowerCase());return T.createElement("div",{className:"bg-color-darken-1 flex-grow flex-column scroll-v"},T.createElement("h3",{className:"margin faded"},"Channels"),n.map(this.renderChannelTab),T.createElement("h3",{className:"margin faded"},"Private Chats"),t.map(this.renderPrivateChatTab))}};const $e=Ue=U.b([Object(L.inject)(function(e){const{chatStore:t,chatViewStore:n,channelStore:r,privateChatStore:s}=e;return{currentRoute:n.route,joinedChannels:r.getJoinedChannels(),privateChats:s.getOpenPrivateChats().filter(e=>!t.isIgnored(e.partner)),onChannelActivate(e){n.setRoute({type:"channel",id:e}),n.navigator.hide()},onChannelClose(e){t.leaveChannel(e)},onPrivateChatActivate(e){n.setRoute({type:"private-chat",partner:e}),n.navigator.hide()},onPrivateChatClose(e){t.removePrivateChat(e)}}}),L.observer],Ue);let He=class extends T.Component{render(){return T.createElement("div",{className:"bg-color-main flex-row full-height",style:{width:"240px"}},T.createElement("div",{className:"bg-color-darken-2 flex-column"},T.createElement("section",{className:"flex-grow flex-column"},T.createElement(x,{icon:"forum",onClick:this.props.onChannelBrowser}),T.createElement(x,{icon:"account-circle",onClick:this.props.onStatusMenu}),T.createElement(x,{icon:"account-multiple",onClick:this.props.onFriendBrowser}),T.createElement(x,{icon:"info",onClick:this.props.onInfo})),T.createElement("section",{className:"flex-column"},T.createElement(x,{icon:"exit",onClick:this.props.onExit}))),T.createElement("div",{className:"flex-grow flex-column flex-align-stretch"},T.createElement(Ne,{name:this.props.identity}),T.createElement("div",{className:"bg-color-darken-2 divider-v"}),T.createElement($e,null)))}};const Be=He=U.b([Object(L.inject)(function(e){const{chatStore:t,chatViewStore:n,appStore:r}=e;return{identity:t.identity,onStatusMenu:n.statusMenu.show,onFriendBrowser:n.friendBrowser.show,onChannelBrowser(){n.channelBrowser.show(),t.fetchChannelList()},onExit(){t.disconnectFromServer()},onInfo(){r.appInfo.toggle()}}}),L.observer],He),Re=Object(V.a)("div")("width:400px;height:600px;max-width:calc(100vw - 40px);max-height:calc(100vh - 40px);");let Je=class extends T.Component{constructor(){super(...arguments),this.renderEntry=(e=>T.createElement("div",{key:e,className:"bg-color-darken-1 padding flex-row flex-align-center spaced-children-h"},T.createElement("img",{src:p(e),style:{width:"24px",height:"24px"}}),T.createElement(de,{name:e})))}render(){const{onlineFriends:e,offlineFriends:t,ignoredUsers:n}=this.props;return T.createElement(Re,{className:"bg-color-main padding spaced-children-v scroll-v"},T.createElement("h2",null,"Friends / Bookmarks"),this.renderUserList(e),T.createElement("h2",null,"Offline"),this.renderUserList(t),T.createElement("h2",null,"Ignored"),this.renderUserList(n))}renderUserList(e){return e.length>0?e.map(this.renderEntry):T.createElement("div",{className:"padding text-small text-italic faded"},"No users found.")}};const _e=Je=U.b([Object(L.inject)(function(e){const t=G()(Object.keys(e.chatStore.friends));return{onlineFriends:t.filter(t=>"offline"!==e.characterStore.getCharacter(t).status),offlineFriends:t.filter(t=>"offline"===e.characterStore.getCharacter(t).status),ignoredUsers:Array.from(e.chatStore.ignored.keys())}}),L.observer],Je);let Fe=class extends T.Component{constructor(){super(...arguments),this.fields={status:"",statusMessage:""},this.updateStatus=this.linkField("status"),this.updateStatusMessage=this.linkField("statusMessage")}linkField(e){return t=>{this.fields[e]=t.currentTarget.value}}handleSubmit(e){this.props.chatStore.updateStatus(this.fields.status,this.fields.statusMessage),this.props.chatViewStore.statusMenu.hide()}componentDidMount(){const e=this.props.chatStore.identityCharacter;this.fields.status=e.status,this.fields.statusMessage=e.statusMessage}render(){return T.createElement("div",{className:"bg-color-main"},T.createElement("form",{onSubmit:a(this.handleSubmit)},T.createElement("fieldset",null,T.createElement("h2",{style:{margin:0}},this.props.chatStore.identity)),T.createElement("fieldset",null,T.createElement("select",{value:this.fields.status,onInput:this.updateStatus},T.createElement("option",{value:"online"},"Online"),T.createElement("option",{value:"looking"},"Looking"),T.createElement("option",{value:"away"},"Away"),T.createElement("option",{value:"busy"},"Busy"),T.createElement("option",{value:"dnd"},"DND"))),T.createElement("fieldset",null,T.createElement("textarea",{placeholder:"Status message...",value:this.fields.statusMessage,onInput:this.updateStatusMessage})),T.createElement("fieldset",null,T.createElement("button",null,"Update"))))}};U.b([$.observable],Fe.prototype,"fields",void 0),U.b([$.action],Fe.prototype,"updateStatus",void 0),U.b([$.action],Fe.prototype,"updateStatusMessage",void 0),U.b([$.action.bound],Fe.prototype,"handleSubmit",null),Fe=U.b([Object(L.inject)("chatStore","chatViewStore"),L.observer],Fe);const Ve=Object(V.a)("div")("width:400px;height:600px;max-width:calc(100vw - 40px);max-height:calc(100vh - 40px);");let Ke=class extends T.Component{constructor(){super(...arguments),this.viewStore=this.props.chatViewStore}handleChannelActivate(e){this.viewStore.setRoute({type:"channel",id:e}),this.viewStore.navigator.hide()}handleClick(){this.viewStore.closeCharacterMenu()}handleContextMenu(e){const t=e.target;t instanceof HTMLElement&&t.dataset&&t.dataset.character&&(e.preventDefault(),this.viewStore.openCharacterMenu(t.dataset.character,e.clientX,e.clientY))}renderRoute(){const{route:e}=this.viewStore;return"channel"===e.type?T.createElement(xe,{id:e.id}):"private-chat"===e.type?T.createElement(Ie,{partner:e.partner}):T.createElement(Z,null,T.createElement("h3",null,"next"))}renderSidebarMenu(){return T.createElement(Y,{className:"flex-row"},this.renderMenu(),T.createElement("div",{className:"divider-h"}))}renderMenu(){return T.createElement(Be,null)}renderDrawerMenu(){const{navigator:e}=this.viewStore;return T.createElement(E,{side:"left",visible:e.isOpen,onShadeClicked:e.hide},this.renderMenu())}renderChannelBrowser(){const{channelBrowser:e}=this.viewStore;return T.createElement(Pe,{visible:e.isOpen},T.createElement(w,{onShadeClick:e.hide},T.createElement(Ve,{className:"bg-color-main"},T.createElement(X,{onDone:e.hide}))))}renderStatusMenu(){const{statusMenu:e}=this.viewStore;return T.createElement(Pe,{visible:e.isOpen},T.createElement(w,{onShadeClick:e.hide},T.createElement(Fe,null)))}renderFriendBrowser(){const{friendBrowser:e}=this.viewStore;return T.createElement(Pe,{visible:e.isOpen},T.createElement(w,{onShadeClick:e.hide},T.createElement(_e,null)))}renderCharacterMenu(){const e=this.viewStore.characterMenu,{open:t}=e,n=U.c(e,["open"]);return T.createElement(Pe,{visible:t},T.createElement(Oe,Object.assign({},n)))}render(){return T.createElement("main",{className:"bg-color-darken-3 fullscreen flex-row",onClick:this.handleClick,onContextMenu:this.handleContextMenu},this.renderSidebarMenu(),T.createElement("section",{className:"flex-grow flex-column"},this.renderRoute()),this.renderDrawerMenu(),this.renderChannelBrowser(),this.renderStatusMenu(),this.renderFriendBrowser(),this.renderCharacterMenu())}};U.b([$.action.bound],Ke.prototype,"handleChannelActivate",null),U.b([$.action.bound],Ke.prototype,"handleClick",null),U.b([$.action.bound],Ke.prototype,"handleContextMenu",null),Ke=U.b([Object(L.inject)("chatStore","chatViewStore","channelStore"),L.observer],Ke);const ze=Object(L.observer)(function(e){return T.createElement(Pe,{visible:e.overlay.isOpen},T.createElement(w,null,T.createElement("div",{className:"bg-color-main text-center padding",style:{width:"300px"}},T.createElement("h2",null,"next"," v","0.12.0"),T.createElement("p",null,"Thanks for testing this early beta! I put a lot of work into this over the past few months, so I hope you'll like it!"),T.createElement("p",null,"Keep in mind: some features may be missing, or even ",T.createElement("strong",null,"horribly")," broken, so use at your own risk!"),T.createElement("p",null,T.createElement("a",{className:"bbc-link",href:"https://github.com/kingdaro/next",target:"_blank"},"Project page on GitHub")),T.createElement("p",null,"If you find a bug or have a suggestion not listed on the project page, make an issue for it on GitHub, or",T.createElement("a",{className:"bbc-link",href:"https://www.f-list.net/c/testificate/",target:"_blank"},"send a note to my testing character.")),T.createElement("p",null,T.createElement("button",{onClick:e.overlay.hide},"I understand. Show me the thing.")))))}),Ge={width:"100px",height:"100px"};let We=class extends T.Component{constructor(){super(...arguments),this.character="",this.storedCharacter=new J("CharacterSelect_character")}handleSubmit(){this.props.onSubmit(this.character)}handleChange(e){this.character=e.currentTarget.value,this.storedCharacter.save(this.character).catch(console.error)}componentDidMount(){return U.a(this,void 0,void 0,function*(){const e=yield this.storedCharacter.restore();this.character=e||""})}render(){return T.createElement("section",{className:"text-center"},T.createElement("h1",null,"Choose your identity."),T.createElement("p",null,T.createElement("img",{style:Ge,src:p(this.character),alt:`Avatar for ${this.character}`})),T.createElement("form",{onSubmit:a(this.handleSubmit)},T.createElement("fieldset",null,T.createElement("select",{value:this.character,onChange:this.handleChange},this.props.characters.map(e=>T.createElement("option",{key:e},e)))),T.createElement("fieldset",null,T.createElement("button",{type:"submit"},"Submit"))),T.createElement("p",null,T.createElement("a",{href:"#",className:"bbc-link",onClick:a(this.props.onBack)},"Back")))}};U.b([$.observable],We.prototype,"character",void 0),U.b([K.bind],We.prototype,"handleSubmit",null),U.b([$.action.bound],We.prototype,"handleChange",null),We=U.b([L.observer],We);let Xe=class extends T.Component{constructor(){super(...arguments),this.username="",this.password="",this.storedUsername=new J("Login_username")}handleSubmit(){this.props.onSubmit(this.username,this.password)}handleUsernameInput(e){this.username=e.currentTarget.value,this.storedUsername.save(this.username).catch(console.error)}handlePasswordInput(e){this.password=e.currentTarget.value}componentDidMount(){return U.a(this,void 0,void 0,function*(){const e=yield this.storedUsername.restore();this.username=e||""})}render(){return T.createElement("section",{className:"text-center"},T.createElement("h1",{className:"margin"},"Hello, beautiful."),T.createElement("form",{onSubmit:a(this.handleSubmit)},T.createElement("fieldset",null,T.createElement("input",{type:"text",placeholder:"Username",value:this.username,onInput:this.handleUsernameInput})),T.createElement("fieldset",null,T.createElement("input",{type:"password",placeholder:"Password",value:this.password,onInput:this.handlePasswordInput})),T.createElement("fieldset",null,T.createElement("button",{type:"submit"},"Submit"))),T.createElement("p",null,this.props.statusText),T.createElement("p",null,T.createElement("a",{className:"bbc-link",href:"#",onClick:this.props.onAbout},"About")))}};U.b([$.observable],Xe.prototype,"username",void 0),U.b([$.observable],Xe.prototype,"password",void 0),U.b([K.bind],Xe.prototype,"handleSubmit",null),U.b([$.action.bound],Xe.prototype,"handleUsernameInput",null),U.b([$.action.bound],Xe.prototype,"handlePasswordInput",null),Xe=U.b([L.observer],Xe);let Ye=class extends T.Component{constructor(){super(...arguments),this.appStore=this.props.appStore,this.authStore=this.props.authStore,this.chatStore=this.props.chatStore,this.loginStatus=""}handleLoginSubmit(e,t){return U.a(this,void 0,void 0,function*(){try{this.loginStatus="Logging in...",yield this.authStore.fetchTicket(e,t),yield this.authStore.fetchCharacters(),this.authStore.saveAuthData().catch(console.error),this.appStore.setState(_.characterSelect),this.loginStatus=""}catch(e){this.loginStatus=e.message||e.toString()}})}handleCharacterSubmit(e){const{account:t,ticket:n}=this.authStore;this.appStore.setState(_.connecting),this.chatStore.connectToServer(t,n,e,this.handleConnect,this.handleDisconnect)}handleConnect(){this.appStore.setState(_.online)}handleDisconnect(){this.appStore.init().catch(console.error)}backToLogin(){this.appStore.setState(_.login)}renderCurrentView(){switch(this.appStore.state){case _.setup:return T.createElement(s,{text:"Setting things up..."});case _.login:return T.createElement(Xe,{statusText:this.loginStatus,onSubmit:this.handleLoginSubmit,onAbout:this.appStore.appInfo.show});case _.characterSelect:return T.createElement(We,{characters:this.authStore.characters,onSubmit:this.handleCharacterSubmit,onBack:this.backToLogin});case _.connecting:return T.createElement(s,{text:"Connecting..."});case _.online:return T.createElement(Ke,null)}}render(){return T.createElement("main",{className:"fullscreen flex-center bg-color-main text-color-main"},this.renderCurrentView(),T.createElement(ze,{overlay:this.appStore.appInfo}))}};U.b([$.observable],Ye.prototype,"loginStatus",void 0),U.b([$.action.bound],Ye.prototype,"handleLoginSubmit",null),U.b([$.action.bound],Ye.prototype,"handleCharacterSubmit",null),U.b([$.action.bound],Ye.prototype,"handleConnect",null),U.b([$.action.bound],Ye.prototype,"handleDisconnect",null),U.b([$.action.bound],Ye.prototype,"backToLogin",null),Ye=U.b([Object(L.inject)("appStore","authStore","chatStore"),L.observer],Ye);class qe{constructor(){this.account="",this.ticket="",this.characters=[]}fetchTicket(e,t){return U.a(this,void 0,void 0,function*(){const n=yield l(e,t);this.account=e,this.ticket=n})}fetchCharacters(){return U.a(this,void 0,void 0,function*(){const{account:e,ticket:t}=this;this.characters=yield h(e,t)})}loadAuthData(){return U.a(this,void 0,void 0,function*(){const e=yield R.a.getItem("AuthStore_auth");e&&(this.account=e.account,this.ticket=e.ticket)})}saveAuthData(){return U.a(this,void 0,void 0,function*(){const{account:e,ticket:t}=this;yield R.a.setItem("AuthStore_auth",{account:e,ticket:t})})}}class Qe{constructor(e,t,n,r){this.type=e,this.id=t,this.title=n,this.userCount=r}}class Ze{constructor(){this.publicChannels=[],this.privateChannels=[]}setPublicChannels(e){this.publicChannels=e}setPrivateChannels(e){this.privateChannels=e}handleSocketCommand(e,t){"CHA"===e?this.setPublicChannels(j(t.channels)):"ORS"===e&&this.setPrivateChannels(j(t.channels))}}U.b([$.observable],Ze.prototype,"publicChannels",void 0),U.b([$.observable],Ze.prototype,"privateChannels",void 0);class et{constructor(e){this.id=e,this.title=this.id,this.description="",this.users=[],this.messages=[],this.ops=[],this.mode="both",this.selectedMode="both"}setUsers(e){this.users=e}addUser(e){this.users.push(e)}removeUser(e){const t=this.users.indexOf(e);t>-1&&this.users.splice(t,1)}getUsers(){return this.users}getUserCount(){return this.users.length}}U.b([$.observable],et.prototype,"title",void 0),U.b([$.observable],et.prototype,"description",void 0),U.b([$.observable],et.prototype,"users",void 0),U.b([$.observable],et.prototype,"messages",void 0),U.b([$.observable],et.prototype,"ops",void 0),U.b([$.observable],et.prototype,"mode",void 0),U.b([$.observable],et.prototype,"selectedMode",void 0),U.b([$.action],et.prototype,"setUsers",null),U.b([$.action],et.prototype,"addUser",null),U.b([$.action],et.prototype,"removeUser",null);class tt{constructor(e,t,n){this.sender=e,this.text=t,this.type=n,this.date=new Date}}class nt{constructor(){this.channels=new Map,this.joinedChannels=new Map,this.storedChannels=new J("ChannelStore_joinedChannels")}getChannel(e){let t=this.channels.get(e);return t||(t=new et(e),this.channels.set(e,t)),t}addJoinedChannel(e){this.joinedChannels.set(e,!0)}removeJoinedChannel(e){this.joinedChannels.delete(e)}getJoinedChannels(){return Array.from(this.joinedChannels.keys()).map(e=>this.getChannel(e))}isJoined(e){return this.joinedChannels.has(e)}saveJoinedChannels(e){return U.a(this,void 0,void 0,function*(){const t=this.getJoinedChannels().map(e=>e.id),n=(yield this.storedChannels.restore())||{};yield this.storedChannels.save(Object.assign({},n,{[e]:t}))})}restoreJoinedChannels(e){return U.a(this,void 0,void 0,function*(){const t=yield this.storedChannels.restore();return t?t[e]||[]:[]})}handleSocketCommand(e,t){if("FLN"===e&&this.channels.forEach(e=>{e.removeUser(t.character)}),"JCH"===e){const e=this.getChannel(t.channel),n=t.character.identity;e.title=t.title,e.addUser(n)}if("LCH"===e&&this.getChannel(t.channel).removeUser(t.character),"ICH"===e){const e=this.getChannel(t.channel),n=t.users;e.setUsers(n.map(e=>e.identity)),e.mode=t.mode}"CDS"===e&&(this.getChannel(t.channel).description=t.description),"COL"===e&&(this.getChannel(t.channel).description=t.oplist),"MSG"===e&&this.getChannel(t.channel).messages.push(new tt(t.character,t.message,"normal")),"LRP"===e&&this.getChannel(t.channel).messages.push(new tt(t.character,t.message,"lfrp"))}}U.b([$.observable],nt.prototype,"channels",void 0),U.b([$.observable],nt.prototype,"joinedChannels",void 0);class rt{constructor(e,t,n,r=""){this.name=e,this.gender=t,this.status="",this.statusMessage="",this.status=n,this.statusMessage=r}}U.b([$.observable],rt.prototype,"status",void 0),U.b([$.observable],rt.prototype,"statusMessage",void 0);class st{constructor(){this.characters=$.observable.map()}getCharacter(e){let t=this.characters.get(e);return t||(t=new rt(e,"None","offline"),this.characters.set(e,t)),t}handleCharacterBatch(e){const t={};e.forEach(([e,n,r,s])=>{t[e]=new rt(e,n,r,s)}),this.characters.merge(t)}handleSocketCommand(e,t){if("LIS"===e&&this.handleCharacterBatch(t.characters),"NLN"===e){const e=this.getCharacter(t.identity);e.gender=t.gender,e.status="online"}if("FLN"===e&&(this.getCharacter(t.character).status="offline"),"STA"===e){const e=this.getCharacter(t.character);e.status=t.status,e.statusMessage=t.statusmsg}}}var at=n(181),it=n.n(at);class ot{constructor(e,t,n,r){this.channels=e,this.privateChats=t,this.characters=n,this.channelList=r,this.identity="",this.friends={},this.admins={},this.ignored=$.observable.map(),this.commandHandlers=[this,this.channels,this.privateChats,this.characters,this.channelList]}connectToServer(e,t,n,r,s){this.disconnectFromServer(),this.identity=n,this.socket=new WebSocket("wss://chat.f-list.net:9799");const a=()=>{this.disconnectFromServer(),s()};this.socket.addEventListener("open",()=>{const r={account:e,ticket:t,character:n,cname:"next",cversion:"0.12.0",method:"ticket"};this.sendSocketCommand("IDN",r)}),this.socket.addEventListener("message",e=>{const t=e.data,n=t.slice(0,3),s=t.length>3?JSON.parse(t.slice(4)):{};"IDN"===n&&r(),this.commandHandlers.forEach(e=>{e.handleSocketCommand(n,s)})}),this.socket.addEventListener("close",a),this.socket.addEventListener("error",a)}disconnectFromServer(){this.socket&&this.socket.close(),this.socket=void 0}sendSocketCommand(e,t){this.socket&&(t?this.socket.send(e+" "+JSON.stringify(t)):this.socket.send(e))}handleSocketCommand(e,t){const n={VAR(){},LIS(){},NLN(){},STA(){},FLN(){},ICH(){},CDS(){},COL(){},MSG(){},LRP(){},PRI(){},CHA(){},ORS(){},PIN(){this.sendSocketCommand("PIN")},IDN(){console.info("Successfully connected to server"),this.restoreJoinedChannels().catch(console.error),this.restorePrivateChats().catch(console.error)},HLO(){console.info(t.message)},CON(){console.info(`There are ${t.count} characters in chat`)},FRL(){const e=t.characters;this.friends=it()(e.map(e=>[e,!0]))},IGN(){const{action:e}=t;if("init"===e){const e=t.characters;this.ignored.merge(it()(e.map(e=>[e,!0])))}else"add"===e?this.ignored.set(t.character,!0):"delete"===e&&this.ignored.delete(t.character)},ADL(){const e=t.ops;this.admins=it()(e.map(e=>[e,!0]))},JCH(){t.character.identity===this.identity&&(this.channels.addJoinedChannel(t.channel),this.saveJoinedChannels().catch(console.error))},LCH(){t.character===this.identity&&(this.channels.removeJoinedChannel(t.channel),this.saveJoinedChannels().catch(console.error))},RTB(){}};n[e]?n[e].call(this):console.log(e,t)}fetchChannelList(){this.sendSocketCommand("CHA"),this.sendSocketCommand("ORS")}joinChannel(e){this.sendSocketCommand("JCH",{channel:e})}leaveChannel(e){this.sendSocketCommand("LCH",{channel:e})}sendChannelMessage(e,t){this.sendSocketCommand("MSG",{channel:e,message:t});const n=this.channels.getChannel(e);n&&n.messages.push(new tt(this.identity,t,"normal"))}saveJoinedChannels(){return U.a(this,void 0,void 0,function*(){yield this.channels.saveJoinedChannels(this.identity)})}restoreJoinedChannels(){return U.a(this,void 0,void 0,function*(){(yield this.channels.restoreJoinedChannels(this.identity)).forEach(e=>{this.joinChannel(e)})})}openPrivateChat(e){this.privateChats.openPrivateChat(e),this.savePrivateChats().catch(console.error)}removePrivateChat(e){this.privateChats.closePrivateChat(e),this.savePrivateChats().catch(console.error)}sendPrivateMessage(e,t){this.sendSocketCommand("PRI",{recipient:e,message:t}),this.privateChats.getPrivateChat(e).messages.push(new tt(this.identity,t,"normal"))}savePrivateChats(){return U.a(this,void 0,void 0,function*(){yield this.privateChats.savePrivateChats(this.identity)})}restorePrivateChats(){return U.a(this,void 0,void 0,function*(){(yield this.privateChats.restorePrivateChats(this.identity)).forEach(this.openPrivateChat.bind(this))})}updateStatus(e,t){this.sendSocketCommand("STA",{status:e,statusmsg:t})}ignore(e){this.sendSocketCommand("IGN",{action:"add",character:e})}unignore(e){this.sendSocketCommand("IGN",{action:"delete",character:e})}isIgnored(e){return this.ignored.has(e)}get identityCharacter(){return this.characters.getCharacter(this.identity)}}U.b([$.observable],ot.prototype,"identity",void 0),U.b([$.observable],ot.prototype,"friends",void 0),U.b([$.observable],ot.prototype,"admins",void 0),U.b([$.computed],ot.prototype,"identityCharacter",null);class ct{constructor(){this.navigator=new H,this.channelBrowser=new H,this.statusMenu=new H,this.friendBrowser=new H,this.route={type:"none"},this.characterMenu={open:!1,x:0,y:0,character:""}}setRoute(e){this.route=e}openCharacterMenu(e,t,n){this.characterMenu.character=e,this.characterMenu.x=t,this.characterMenu.y=n,this.characterMenu.open=!0}closeCharacterMenu(){this.characterMenu.open=!1}}U.b([$.observable],ct.prototype,"route",void 0),U.b([$.observable],ct.prototype,"characterMenu",void 0),U.b([$.action.bound],ct.prototype,"setRoute",null),U.b([$.action],ct.prototype,"openCharacterMenu",null),U.b([$.action],ct.prototype,"closeCharacterMenu",null);class lt{constructor(e){this.partner=e,this.messages=[]}}U.b([$.observable],lt.prototype,"messages",void 0);class ht{constructor(){this.privateChats=new Map,this.openPrivateChats=new Map,this.storedPrivateChats=new J("PrivateChatStore_privateChats")}getPrivateChat(e){let t=this.privateChats.get(e);return t||(t=new lt(e),this.privateChats.set(e,t)),t}openPrivateChat(e){return this.openPrivateChats.set(e,!0),this.getPrivateChat(e)}closePrivateChat(e){this.openPrivateChats.delete(e)}getOpenPrivateChats(){return Array.from(this.openPrivateChats.keys()).map(e=>this.getPrivateChat(e))}handleSocketCommand(e,t){"PRI"===e&&this.openPrivateChat(t.character).messages.push(new tt(t.character,t.message,"normal"))}savePrivateChats(e){return U.a(this,void 0,void 0,function*(){const t=(yield this.storedPrivateChats.restore())||{},n=Object.assign({},t,{[e]:Array.from(this.openPrivateChats.keys())});yield this.storedPrivateChats.save(n)})}restorePrivateChats(e){return U.a(this,void 0,void 0,function*(){return((yield this.storedPrivateChats.restore())||{})[e]||[]})}}U.b([$.observable],ht.prototype,"privateChats",void 0),U.b([$.observable],ht.prototype,"openPrivateChats",void 0);const dt=new nt,pt=new ht,ut=new st,mt=new Ze,gt=new ot(dt,pt,ut,mt),vt=new ct,bt=new qe,Ct={appStore:new F(bt),authStore:bt,channelBrowserStore:mt,channelStore:dt,characterStore:ut,chatStore:gt,chatViewStore:vt,privateChatStore:pt},ft=!1;P(),Ct.appStore.init().catch(console.error),ft&&(window.stores=Ct)},57:function(e,t){},70:function(e,t){}},[56]);